<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Company Questions - Company-wise Interview Questions and Solutions</title>
    <meta name="description" content="Prepare for software engineering interviews with our extensive collection of LeetCode questions categorized by company. Access coding challenges and solutions tailored for interviews at top tech companies like Google, Amazon, Facebook, Apple, Netflix, and more. Track your progress, visualize completion rates, and save your practice sessions.">
    <meta name="keywords" content="LeetCode, LeetCode questions by company, coding interview prep, software engineering interview, FAANG interview questions, top tech companies interview prep, Google interview questions, Amazon interview questions, Facebook interview questions, Apple interview questions, Netflix interview questions, Microsoft interview questions, algorithm problems, data structure questions, coding practice, interview guide, technical interviews, problem-solving, software developer interview prep, SDE interviews, tech job preparation, coding challenge solutions, computer science interviews, tech hiring, LeetCode progress tracker, company-wise LeetCode, LeetCode company tracker, LeetCode interview prep, LeetCode practice tracker">
    <meta name="author" content="Ronak Raj">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://ronakraj00.github.io/CodeCompanyWise/" />
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ronakraj00.github.io/CodeCompanyWise/">
    <meta property="og:title" content="LeetCode Company Questions - Company-wise Interview Questions and Solutions">
    <meta property="og:description" content="Prepare for software engineering interviews with company-specific LeetCode questions. Track progress, save sessions, and visualize completion rates for FAANG and tech company interviews.">
    <meta property="og:image" content="https://ronakraj00.github.io/CodeCompanyWise/og-image.png">
    <!-- <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630"> -->
    <meta property="og:site_name" content="LeetCode Company Questions">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://ronakraj00.github.io/CodeCompanyWise/">
    <meta property="twitter:title" content="LeetCode Company Questions - Company-wise Interview Questions and Solutions">
    <meta property="twitter:description" content="Prepare for software engineering interviews with company-specific LeetCode questions. Track progress, save sessions, and visualize completion rates for FAANG and tech company interviews.">
    <meta property="twitter:image" content="https://ronakraj00.github.io/CodeCompanyWise/og-image.png">
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LeetCode Company Questions">
    <!-- Google Search Console Verification -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE" /> -->
    <!-- Structured Data JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "LeetCode Company Questions",
      "alternateName": "Company-wise LeetCode Progress Tracker",
      "url": "https://ronakraj00.github.io/CodeCompanyWise/",
      "description": "Prepare for software engineering interviews with our extensive collection of LeetCode questions categorized by company. Access coding challenges and solutions tailored for interviews at top tech companies like Google, Amazon, Facebook, Apple, Netflix, and more.",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Person",
        "name": "Ronak Raj",
        "url": "https://ronakraj00.github.io/portfolio/"
      },
      "keywords": "LeetCode, coding interview prep, software engineering interview, FAANG interview questions, algorithm problems, data structure questions",
      "audience": {
        "@type": "Audience",
        "audienceType": "Software Engineers, Computer Science Students, Tech Job Seekers"
      }
    }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MZ8LK7B9KN"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-MZ8LK7B9KN');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/counterapi/dist/counter.browser.min.js"></script>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <style>
        :root {
            --bg-main: #18181b;
            --bg-card: #23232a;
            --bg-accent: #23232b;
            --text-main: #f4f4f5;
            --text-muted: #a1a1aa;
            --border-main: #3d3d3d;
            --accent: #6366f1;
            --accent2: #22c55e;
            --accent3: #eab308;
            --accent4: #ef4444;
            --shadow: 0 2px 12px 0 #0000001a;
            --transition: background 0.3s, color 0.3s, border 0.3s;
            --pill-bg: color-mix(in srgb, var(--accent) 10%, var(--bg-accent) 90%);
            --pill-text: var(--accent);
            --progress-bar-bg: var(--bg-accent);
            --progress-bar-border: var(--border-main);
            --progress-bar-gradient: linear-gradient(90deg, var(--accent), var(--accent2));
            --divider: var(--border-main);
            --modal-overlay: rgba(0,0,0,0.45);
            --hover-bg: #23232b;
            --aurora1: #7dd3fc;
            --aurora2: #6366f1;
            --aurora3: #facc15;
            --aurora4: #22d3ee;
        }
        .theme-light {
            --bg-main: #f7f7fa;
            --bg-card: #fff;
            --bg-accent: #fefeff;
            --text-main: #23232a;
            --text-muted: #6b7280;
            --border-main: #d1d5db;
            --accent: #6366f1;
            --accent2: #22c55e;
            --accent3: #eab308;
            --accent4: #ef4444;
            --shadow: 0 2px 12px 0 #6366f122;
            --pill-bg: color-mix(in srgb, var(--accent) 10%, var(--bg-accent) 90%);
            --pill-text: var(--accent);
            --progress-bar-bg: var(--bg-accent);
            --progress-bar-border: var(--border-main);
            --progress-bar-gradient: linear-gradient(90deg, var(--accent), var(--accent2));
            --divider: var(--border-main);
            --modal-overlay: rgba(100,100,120,0.18);
            --hover-bg: #f1f5fb;
            --aurora1: #a5b4fc;
            --aurora2: #f0abfc;
            --aurora3: #fde68a;
            --aurora4: #6ee7b7;
        }
        .theme-solarized {
            --bg-main: #fdf6e3;
            --bg-card: #f5ecd7;
            --bg-accent: #fff7e5;
            --text-main: #657b83;
            --text-muted: #93a1a1;
            --border-main: #d1cfae;
            --accent: #268bd2;
            --accent2: #859900;
            --accent3: #b58900;
            --accent4: #dc322f;
            --shadow: 0 2px 12px 0 #b5890033;
            --pill-bg: color-mix(in srgb, var(--accent) 10%, var(--bg-accent) 90%);
            --pill-text: var(--accent);
            --progress-bar-bg: var(--bg-accent);
            --progress-bar-border: var(--border-main);
            --progress-bar-gradient: linear-gradient(90deg, var(--accent), var(--accent2));
            --divider: var(--border-main);
            --modal-overlay: rgba(200,180,100,0.13);
            --hover-bg: #ece5c7;
            --aurora1: #268bd2;
            --aurora2: #b58900;
            --aurora3: #859900;
            --aurora4: #2aa198;
        }
        .theme-forest {
            --bg-main: #1b2b1b;
            --bg-card: #223322;
            --bg-accent: #2d4a2d;
            --text-main: #e6ffe6;
            --text-muted: #a3c9a3;
            --border-main: #3a5c3a;
            --accent: #4ade80;
            --accent2: #22d3ee;
            --accent3: #a3e635;
            --accent4: #facc15;
            --shadow: 0 2px 12px 0 #4ade8033;
            --pill-bg: color-mix(in srgb, var(--accent) 10%, var(--bg-accent) 90%);
            --pill-text: var(--accent);
            --progress-bar-bg: var(--bg-accent);
            --progress-bar-border: var(--border-main);
            --progress-bar-gradient: linear-gradient(90deg, var(--accent), var(--accent2));
            --divider: var(--border-main);
            --modal-overlay: rgba(34,211,238,0.13);
            --hover-bg: #294429;
            --aurora1: #4ade80;
            --aurora2: #22d3ee;
            --aurora3: #a3e635;
            --aurora4: #facc15;
        }
        .theme-ocean {
            --bg-main: #0a192f;
            --bg-card: #112240;
            --bg-accent: #233554;
            --text-main: #dbeafe;
            --text-muted: #7dd3fc;
            --border-main: #334155;
            --accent: #38bdf8;
            --accent2: #06b6d4;
            --accent3: #818cf8;
            --accent4: #f472b6;
            --shadow: 0 2px 12px 0 #38bdf833;
            --pill-bg: color-mix(in srgb, var(--accent) 10%, var(--bg-accent) 90%);
            --pill-text: var(--accent);
            --progress-bar-bg: var(--bg-accent);
            --progress-bar-border: var(--border-main);
            --progress-bar-gradient: linear-gradient(90deg, var(--accent), var(--accent2));
            --divider: var(--border-main);
            --modal-overlay: rgba(6,182,212,0.13);
            --hover-bg: #1e293b;
            --aurora1: #38bdf8;
            --aurora2: #818cf8;
            --aurora3: #f472b6;
            --aurora4: #06b6d4;
        }
        .theme-cyberpunk {
            --bg-main: #18122B;
            --bg-card: #232046;
            --bg-accent: #2d1e4a;
            --text-main: #f8fafc;
            --text-muted: #f472b6;
            --border-main: #a21caf;
            --accent: #f472b6;
            --accent2: #facc15;
            --accent3: #38bdf8;
            --accent4: #a21caf;
            --shadow: 0 2px 12px 0 #f472b633;
            --pill-bg: color-mix(in srgb, var(--accent) 10%, var(--bg-accent) 90%);
            --pill-text: var(--accent);
            --progress-bar-bg: var(--bg-accent);
            --progress-bar-border: var(--border-main);
            --progress-bar-gradient: linear-gradient(90deg, var(--accent), var(--accent2));
            --divider: var(--border-main);
            --modal-overlay: rgba(250,204,21,0.13);
            --hover-bg: #3b0764;
            --aurora1: #f472b6;
            --aurora2: #facc15;
            --aurora3: #38bdf8;
            --aurora4: #a21caf;
        }
        body {
            background: var(--bg-main);
            color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            transition: var(--transition);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 36px;
            position: relative;
        }
        /* Refined Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 18px;
            right: 24px;
            z-index: 20;
            display: flex;
            align-items: center;
        }
        .theme-toggle-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--bg-accent);
            color: var(--accent);
            border: 1.5px solid var(--border-main);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.35em;
            cursor: pointer;
            transition: var(--transition), box-shadow 0.2s;
            outline: none;
            position: relative;
        }
        .theme-toggle-btn:focus-visible {
            box-shadow: 0 0 0 3px var(--accent);
        }
        .theme-toggle-btn:hover, .theme-toggle-btn:focus {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        .theme-toggle-btn svg {
            width: 1.5em;
            height: 1.5em;
            display: block;
        }
        .theme-toggle-btn .theme-toggle-arrow {
            margin-left: 0.2em;
            font-size: 0.8em;
            transition: transform 0.2s;
        }
        .theme-dropdown {
            position: absolute;
            top: 54px;
            right: 0;
            background: var(--bg-card);
            border: 1.5px solid var(--border-main);
            border-radius: 14px;
            box-shadow: var(--shadow);
            z-index: 100;
            min-width: 170px;
            display: none;
            flex-direction: column;
            padding: 8px 0;
            opacity: 0;
            transform: translateY(-8px) scale(0.98);
            pointer-events: none;
            transition: opacity 0.18s, transform 0.18s;
        }
        .theme-dropdown.show {
            display: flex;
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }
        .theme-dropdown-item {
            width: calc(100% - 20px);
            background: none;
            border: none;
            color: var(--text-main);
            text-align: left;
            padding: 12px 22px 12px 18px;
            font-size: 1.08em;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.18s, color 0.18s;
            margin: 10px;
        }
        .theme-dropdown-item svg {
            width: 1.2em;
            height: 1.2em;
        }
        .theme-dropdown-item.active, .theme-dropdown-item:hover, .theme-dropdown-item:focus {
            background: var(--accent);
            color: #fff;
            outline: none;
            border-color: var(--accent);
        }
        .theme-dropdown-item:focus-visible {
            box-shadow: 0 0 0 2px var(--accent);
        }
        /* Smooth transitions for theme changes */
        * {
            transition: var(--transition);
        }
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 8px;
            font-weight: 800;
            letter-spacing: -0.03em;
            line-height: 1.3;
            position: relative;
            display: inline-block;
        }
        .header h1::after {
            content: '';
            display: block;
            margin: 0 auto;
            margin-top: 8px;
            width: 60%;
            height: 4px;
            border-radius: 2px;
            background: linear-gradient(90deg, var(--accent) 40%, var(--accent2) 100%);
            opacity: 0.7;
            margin-bottom: 30px;
        }
        .header p {
            font-size: 1.18rem;
            color: var(--text-muted);
            margin-top: 10px;
            font-weight: 500;
            letter-spacing: 0.01em;
        }
        .upload-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px 0 #0000000d;
            border: 1px solid var(--border-main);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: var(--bg-accent);
            color: var(--accent);
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            border: 1px solid var(--border-main);
            transition: background 0.2s, border 0.2s;
        }
        .file-input-wrapper:hover {
            background: var(--hover-bg);
            border-color: var(--accent);
        }
        .file-input-wrapper input[type=file] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 8px 0 #0000000d;
            border: 1px solid var(--border-main);
            transition: box-shadow 0.2s, border 0.2s;
        }
        .stat-card:hover {
            box-shadow: 0 4px 16px 0 var(--shadow);
            border-color: var(--accent);
            background: var(--hover-bg);
        }
        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .stat-label {
            font-size: 1rem;
            color: #a1a1aa;
        }
        .easy { color: var(--accent2); }
        .medium { color: var(--accent3); }
        .hard { color: var(--accent4); }
        .completed { color: #6366f1; }
        .controls {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px 0 #0000000d;
            border: 1px solid var(--border-main);
        }
        .filter-controls-group {
            display: flex;
            gap: 18px;
            align-items: flex-end;
            background: var(--bg-accent);
            border-radius: 10px;
            padding: 16px 18px 10px 18px;
            margin-bottom: 12px;
            border: 1px solid var(--border-main);
        }
        .filter-search-group {
            display: flex;
            gap: 18px;
            align-items: flex-end;
            background: var(--bg-accent);
            border-radius: 10px;
            padding: 16px 18px 10px 18px;
            margin-bottom: 12px;
            border: 1px solid var(--border-main);
        }
        .filter-actions-group {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            background: var(--bg-accent);
            border-radius: 10px;
            padding: 16px 18px 10px 18px;
            margin-bottom: 0;
            border: 1px solid var(--border-main);
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        select, input[type="text"] {
            padding: 10px 15px;
            border: 1px solid var(--border-main);
            background: var(--bg-accent);
            color: var(--text-main);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s, background 0.2s;
        }
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #6366f1;
            background: #23232b;
        }
        .reset-btn {
            background: var(--bg-accent);
            color: var(--accent);
            border: 1px solid var(--border-main);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s, border 0.2s, color 0.2s, box-shadow 0.2s;
            box-shadow: 0 1px 2px 0 #0000000d;
        }
        .reset-btn:hover, .reset-btn:focus {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 4px 16px 0 var(--shadow);
        }
        .reset-btn[style*='background: #059669'],
        .reset-btn[style*='background: #7c3aed'] {
            background: var(--bg-accent) !important;
            color: var(--text-main) !important;
            border: 1px solid var(--border-main) !important;
        }
        .reset-btn[style*='background: #059669']:hover,
        .reset-btn[style*='background: #7c3aed']:hover {
            background: var(--bg-main) !important;
            color: var(--accent) !important;
            border-color: var(--accent) !important;
        }
        .progress-bar {
            width: 100%;
            height: 18px;
            background: var(--progress-bar-bg);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            border: 1px solid var(--progress-bar-border);
        }
        .progress-fill {
            height: 100%;
            background: var(--progress-bar-gradient);
            transition: width 0.3s cubic-bezier(.4,2,.6,1);
        }
        .chart-container {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px 0 #0000000d;
            border: 1px solid var(--border-main);
        }
        .questions-table {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 24px;
            /* box-shadow: 0 2px 8px 0 #0000000d; */
            border: 1px solid var(--border-main);
            overflow-x: auto;
            min-width: 0;
            width: 100%;
            display: block;
        }
        .questions-table table {
            min-width: 800px;
            width: 100%;
            table-layout: auto;
        }
        .questions-table th, .questions-table td {
            white-space: nowrap;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--bg-card);
            color: var(--text-main);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border-main);
        }
        th {
            /* background: var(--bg-card); */
            font-weight: 600;
            color: var(--text-main);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:hover {
            background: var(--hover-bg);
        }
        .question-title {
            font-weight: 600;
            color: var(--text-main);
            text-decoration: none;
        }
        .question-title:hover {
            text-decoration: underline;
            color: var(--text-muted);
        }
        .question-id {
            color: var(--text-muted);
            font-weight: 500;
        }
        .question-link {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.95rem;
        }
        .question-link:hover {
            text-decoration: underline;
            color: var(--accent2);
        }
        .difficulty-badge {
            padding: 5px 12px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            border: 1px solid var(--border-main);
        }
        .difficulty-easy {
            background: color-mix(in srgb, var(--accent2) 10%, transparent) !important;
            color: var(--accent2) !important;
            border-color: color-mix(in srgb, var(--accent2) 20%, transparent) !important;
        }
        .difficulty-medium {
            background: color-mix(in srgb, var(--accent3) 10%, transparent) !important;
            color: var(--accent3) !important;
            border-color: color-mix(in srgb, var(--accent3) 20%, transparent) !important;
        }
        .difficulty-hard {
            background: color-mix(in srgb, var(--accent4) 10%, transparent) !important;
            color: var(--accent4) !important;
            border-color: color-mix(in srgb, var(--accent4) 20%, transparent) !important;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        .checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid var(--accent);
            border-radius: 6px;
            background: var(--bg-accent);
            cursor: pointer;
            display: inline-block;
            position: relative;
            transition: border-color 0.2s, background 0.2s;
            margin: 0;
            vertical-align: middle;
        }
        .checkbox:checked {
            background: var(--accent);
            border-color: var(--accent);
        }
        .checkbox:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
        .checkbox:checked::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 7px;
            height: 13px;
            border: solid #fff;
            border-width: 0 2px 2px 0;
            border-radius: 1px;
            transform: translate(-50%, -50%) rotate(45deg);
            pointer-events: none;
        }
        td:first-child {
            text-align: center;
            vertical-align: middle;
            padding-left: 0;
            padding-right: 0;
        }
        .acceptance-rate {
            font-weight: 600;
            color: var(--accent2);
        }
        .frequency-bar {
            width: 100px;
            height: 10px;
            background: var(--bg-accent);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border-main);
            margin: 0 auto;
        }
        .frequency-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 6px 0 0 6px;
            transition: width 0.3s cubic-bezier(.4,2,.6,1);
        }
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #a1a1aa;
            font-size: 1.1rem;
        }
        .saved-file-btn {
            background: none;
            color: var(--text-main);
            border: 1px solid var(--border-main);
            padding: 12px 48px 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s, border 0.2s, color 0.2s, box-shadow 0.2s;
            box-shadow: 0 1px 2px 0 #0000000d;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-width: 180px;
            position: relative;
            width: 260px;
            max-width: 260px;
            overflow-wrap: break-word;
            word-break: break-word;
            min-height: 50px;
            justify-content: center;
        }
        .saved-file-btn:hover, .saved-file-btn:focus {
            background: var(--hover-bg);
            border-color: var(--accent);
            color: var(--accent);
            outline: none;
        }
        .saved-file-btn.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        .file-actions {
            position: absolute;
            bottom: 8px;
            right: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .file-menu-btn {
            background: none;
            border: none;
            color: #a1a1aa;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background 0.2s, color 0.2s;
        }
        .file-menu-btn:hover, .file-menu-btn:focus {
            background: var(--hover-bg);
            color: var(--accent);
            outline: none;
            border-color: var(--accent);
        }
        .file-menu-popover {
            display: none;
            position: absolute;
            top: 32px;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-main);
            border-radius: 8px;
            box-shadow: 0 4px 24px #00000022;
            z-index: 100;
            min-width: 120px;
        }
        .file-menu-popover.show {
            display: block;
        }
        .file-menu-item {
            width: 100%;
            background: none;
            border: none;
            color: var(--accent4);
            text-align: left;
            padding: 10px 16px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        .file-menu-item:hover, .file-menu-item:focus {
            background: var(--hover-bg);
            color: #fff;
            outline: none;
            border-color: var(--accent4);
        }
        .delete-file-btn {
            background: var(--accent4);
            color: #fff;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 5px;
            transition: background 0.2s;
        }
        .delete-file-btn:hover, .delete-file-btn:focus {
            background: var(--accent4);
            outline: none;
            border-color: var(--accent4);
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .filter-controls-group, .filter-search-group, .filter-actions-group {
                flex-direction: column;
                align-items: stretch;
            }
            .filter-group {
                justify-content: space-between;
            }
            .header h1 {
                font-size: 2rem;
            }
            table {
                font-size: 0.9rem;
            }
            th, td {
                padding: 10px;
            }
        }
        .collapsible-section {
            margin-bottom: 28px;
            border-radius: 12px;
            overflow: hidden;
            background: none;
            box-shadow: 0 2px 12px 0 #0000000d;
            border: 1.5px solid var(--border-main);
            transition: box-shadow 0.2s;
        }
        .collapsible-header {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            color: var(--text-main) !important;
            font-size: 1.18rem;
            font-weight: 600;
            padding: 20px 28px 18px 28px;
            border: none;
            border-radius: 12px 12px 0 0;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            user-select: none;
            outline: none;
            position: relative;
        }
        .collapsible-header:focus-visible {
            box-shadow: 0 0 0 2px #6366f1;
            z-index: 2;
        }
        /* .collapsible-header:hover {
            background: var(--hover-bg);
            color: var(--accent);
            border-color: var(--accent);
        } */
        .collapsible-chevron {
            display: flex;
            align-items: center;
            transition: transform 0.25s cubic-bezier(.4,2,.6,1);
            width: 1.3em;
            height: 1.3em;
        }
        .collapsible-section.collapsed .collapsible-chevron {
            transform: rotate(-90deg);
        }
        .collapsible-divider {
            width: 100%;
            height: 1.5px;
            background: var(--divider);
            border-radius: 1px;
            margin: 0 0 0 0;
        }
        .collapsible-content {
            display: block;
            max-height: 0;
            overflow: hidden;
            padding: 0 28px;
            background: var(--bg-card);
            border-radius: 0 0 12px 12px;
            transition: max-height 0.35s cubic-bezier(.4,2,.6,1), padding 0.2s;
        }
        .collapsible-section:not(.collapsed) .collapsible-content {
            padding: 22px 28px 28px 28px;
            max-height: 5000px;
            overflow: visible;
            transition: max-height 0.5s cubic-bezier(.4,2,.6,1), padding 0.2s;
        }
        .collapsible-section.collapsed .collapsible-content {
            padding: 0 28px;
            max-height: 0;
        }
        #questionsSection.collapsible-section:not(.collapsed) .collapsible-content {
            max-height: none;
        }
        .questions-table-scroll {
            overflow-x: auto;
            width: 100%;
        }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--modal-overlay);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal {
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: 0 8px 32px #00000044;
            padding: 32px 28px 24px 28px;
            min-width: 340px;
            max-width: 95vw;
            max-height: 80vh;
            overflow-y: auto;
            color: var(--text-main);
            position: relative;
        }
        .modal h2 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 18px;
        }
        .modal-search {
            width: calc(100% - 20px);
            padding: 10px 14px;
            border-radius: 6px;
            border: 1px solid var(--border-main);
            background: var(--bg-accent);
            color: var(--text-main);
            margin-bottom: 18px;
            font-size: 1rem;
        }
        .modal-list {
            max-height: 45vh;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .modal-list-item {
            text-transform: capitalize;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-main);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 2px;
            transition: background 0.2s;
        }
        .modal-list-item:last-child {
            border-bottom: none;
        }
        .modal-list-item:hover, .modal-list-item:focus {
            background: var(--hover-bg);
            color: var(--accent);
            border-color: var(--accent);
        }
        .modal-list-item strong {
            font-size: 1.05em;
        }
        .modal-close {
            position: absolute;
            top: 12px;
            right: 18px;
            background: none;
            border: none;
            color: #a1a1aa;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover {
            color: #ef4444;
        }
        .advanced-features {
            width: min(350px,100% - 20px);
            background: var(--bg-card) !important;
            border: 1.5px solid var(--border-main) !important;
            margin-top: 24px;
            border-radius: 10px;
            
            box-shadow: 0 2px 8px 0 #0000000d;
            overflow: hidden;
        }
        .advanced-header {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            background:var(--bg-main);
            color: #a1a1aa;
            font-size: 1.08rem;
            font-weight: 600;
            padding: 14px 22px;
            border: none;
            border-radius: 10px 10px 0 0;
            user-select: none;
            outline: none;
        }
        .advanced-header:hover {
            background: var(--hover-bg);
            color: var(--accent);
            border-color: var(--accent);
        }
        .advanced-chevron {
            transition: transform 0.2s;
            font-size: 1.1em;
        }
        .advanced-features.collapsed .advanced-chevron {
            transform: rotate(-90deg);
        }
        .advanced-content {
            display: block;
            max-height: 0;
            overflow: hidden;
            padding: 0 22px;
            background: var(--bg-card);
            border-radius: 0 0 10px 10px;
            transition: max-height 0.3s, padding 0.2s;
        }
        .advanced-features:not(.collapsed) .advanced-content {
            padding: 18px 22px 22px 22px;
            max-height: 800px;
        }
        .advanced-features.collapsed .advanced-content {
            padding: 0 22px;
            max-height: 0;
        }
        #savedFilesList {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin-bottom: 10px;
            align-items: stretch;
        }
        .saved-file-progress-pill {
            display: inline-block;
            /* border: 1px solid #6366f1; */
            border-radius: 50px;
            padding: 1px 8px;
            font-size: 0.7em;
            font-weight: 600;
            color: var(--pill-text);
            background: var(--pill-bg);
            margin-top: 4px;
        }
        .refined-charts {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            justify-content: space-between;
            align-items: flex-start;
        }
        .chart-card {
            background: var(--bg-card);
            border: 1.5px solid var(--border-main);
            border-radius: 14px;
            box-shadow: 0 2px 12px 0 #0000000d;
            padding: 22px 18px 18px 18px;
            margin-bottom: 8px;
            flex: 1 1 320px;
            min-width: 220px;
            max-width: 420px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .chart-title {
            font-size: 1.08em;
            color: #a1a1aa;
            font-weight: 600;
            margin-bottom: 12px;
            text-align: center;
        }
        @media (max-width: 1100px) {
            .refined-charts {
                flex-direction: column;
                gap: 18px;
            }
            .chart-card {
                max-width: 100%;
                min-width: 0;
            }
        }
        .collapsible-section.stats-card, .collapsible-section.controls-card {
            background: var(--bg-card);
            border: 1.5px solid var(--border-main);
            border-radius: 14px;
            box-shadow: 0 2px 12px 0 #0000000d;
            margin-bottom: 28px;
        }
        .stats-section {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-bottom: 30px;
            justify-content: space-between;
        }
        .stat-card {
            background: var(--bg-card);
            border: 1.5px solid var(--border-main);
            border-radius: 12px;
            padding: 24px 32px;
            text-align: center;
            box-shadow: 0 2px 8px 0 #0000000d;
            transition: box-shadow 0.2s, border 0.2s, background 0.2s;
            min-width: 120px;
            flex: 1 1 120px;
            margin: 0 0 0 0;
        }
        .stat-card:hover {
            box-shadow: 0 4px 16px 0 #6366f133;
            border-color: #6366f1;
            background: var(--hover-bg);
        }
        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .stat-label {
            font-size: 1rem;
            color: var(--text-muted);
        }
        .controls {
            background: var(--bg-card);
            border: 1.5px solid var(--border-main);
            border-radius: 12px;
            padding: 24px 32px;
            margin-bottom: 0;
            box-shadow: 0 2px 8px 0 #0000000d;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            align-items: center;
            margin-bottom: 0;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 140px;
        }
        .filter-group label {
            color: #a1a1aa;
            font-size: 0.98em;
            font-weight: 500;
            margin-bottom: 2px;
        }
        .filter-group select, .filter-group input[type="text"] {
            background: var(--bg-accent);
            color: var(--text-main);
            border: 1.5px solid var(--border-main);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 1em;
            transition: border 0.18s, box-shadow 0.18s;
        }
        .filter-group select:focus, .filter-group input[type="text"]:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 2px var(--accent);
            background: var(--bg-accent);
        }
        .reset-btn {
            background: var(--bg-accent);
            color: var(--accent);
            border: 1.5px solid var(--border-main);
            border-radius: 8px;
            padding: 10px 18px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.18s, border 0.18s, color 0.18s, box-shadow 0.18s;
            margin-top: 8px;
        }
        .reset-btn:hover, .reset-btn:focus {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 4px 16px 0 #6366f133;
        }
        @media (max-width: 900px) {
            .stats-section {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 14px;
            }
            .controls {
                padding: 18px 10px;
            }
            .filter-row {
                flex-direction: column;
                gap: 10px;
            }
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 18px 0 0 0;
            flex-wrap: wrap;
            max-width: 100%;
            overflow-x: auto;
        }
        .pagination-btn {
            /* min-width: 36px; */
            padding: 6px 10px;
            font-size: 0.98em;
            background: var(--bg-accent);
            color: var(--accent);
            border: 1.5px solid var(--border-main);
            border-radius: 6px;
            padding: 6px 14px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.18s, border 0.18s, color 0.18s;
        }
        @media (max-width: 600px) {
            .pagination {
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
                padding-bottom: 6px;
            }
            .pagination-btn {
                width: fit-content;
                /* min-width: 32px; */
                padding: 6px 6px;
                font-size: 0.95em;
            }
        }
        .pagination-btn.active, .pagination-btn:focus {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
            outline: none;
        }
        .pagination-btn[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }
        @media (max-width: 600px) {
            .theme-toggle {
                position: static;
                width: 100%;
                display: flex;
                justify-content: flex-end;
                margin-bottom: 10px;
                box-shadow: none;
            }
            .theme-toggle-btn {
                width: 36px;
                height: 36px;
                font-size: 1.05em;
            }
            .header {
                padding-top: 0;
            }
        }
        .questions-table.collapsible-section {
            max-width: 1200px;
            margin: 0 auto 28px auto;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 2px 8px 0 #0000000d;
            border: 1.5px solid var(--border-main);
        }
        .questions-table-scroll {
            padding: 0 0 18px 0;
        }
        .questions-table table {
            margin-top: 0;
        }
        .collapsible-content {
            padding: 0 32px 32px 32px;
        }
        @media (max-width: 900px) {
            .questions-table.collapsible-section {
                max-width: 100%;
                padding: 0;
            }
            .collapsible-content {
                padding: 0 8px 18px 8px;
            }
        }
        .stat-card,
        .controls,
        .chart-container,
        .collapsible-section {
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        #advancedFeatures .file-input-wrapper,
        #advancedFeatures input[type="text"],
        #advancedFeatures #saveFileBtn {
            background: var(--bg-accent) !important;
            color: var(--text-main) !important;
            border: 1.5px solid var(--border-main) !important;
            border-radius: 8px !important;
            font-size: 1em !important;
            transition: background 0.2s, border 0.2s, color 0.2s;
        }
        #advancedFeatures #saveFileBtn {
            background: var(--accent2) !important;
            color: #fff !important;
            font-weight: 600 !important;
            border: none !important;
        }
        #advancedFeatures #saveFileBtn:hover, #advancedFeatures #saveFileBtn:focus {
            background: var(--accent) !important;
            color: #fff !important;
        }
        #advancedFeatures input[type="text"]::placeholder {
            color: var(--text-muted) !important;
            opacity: 1;
        }
        .question-row-completed {
            background: color-mix(in srgb, var(--accent2) 12%, var(--bg-card) 88%) !important;
            /* fallback for browsers without color-mix */
            /* background: #e6f9ed !important; */
        }
        .themed-hr {
            border: none;
            border-top: 2px solid var(--border-main);
            margin: 32px 0 18px 0;
            width: 100%;
        }

        body.modal-open,
        html.modal-open {
            overflow: hidden;
        }

        /* GitHub Modal Refinements */
        #githubModal.github-modal .modal {
            padding: 0;
            display: flex;
            flex-direction: column;
            max-height: 75vh;
            min-height: 300px;
        }
        .github-modal-header {
            padding: 18px 24px;
            border-bottom: 1px solid var(--border-main);
            flex-shrink: 0;
            position: relative;
        }
        .github-modal-header h2 {
            margin: 0;
            font-size: 1.25rem;
        }
        .github-modal .modal-close {
            top: 14px;
            right: 20px;
        }
        .github-modal-search-wrapper {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-main);
            background: var(--bg-accent);
            flex-shrink: 0;
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .github-modal-search {
            width: 100%;
            padding: 12px 18px;
            border-radius: 8px;
            border: 1.5px solid var(--border-main);
            background: var(--bg-main);
            color: var(--text-main);
            font-size: 1.05rem;
            box-sizing: border-box;
            transition: border 0.2s, box-shadow 0.2s;
        }
        .github-modal-search:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent);
        }
        .github-modal .modal-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 8px;
            max-height: initial; /* Override old style */
            margin-bottom: 0; /* Override old style */
        }
        .github-modal .modal-list-item {
            padding: 14px 20px;
            border-radius: 8px;
            border-bottom: none;
            gap: 12px;
            flex-direction: row; /* Changed from column */
            align-items: center;
        }
        .github-modal .modal-list-item svg {
            width: 1.5em;
            height: 1.5em;
            color: var(--accent);
            flex-shrink: 0;
        }
        .github-modal .modal-list-item strong {
            font-size: 1.1em;
            font-weight: 600;
        }
        .github-modal .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            background: var(--bg-accent);
            color: var(--text-muted);
            transition: background 0.2s, color 0.2s;
            border: 1px solid var(--border-main);
        }
        .github-modal .back-btn:hover {
            background: var(--hover-bg);
            color: var(--accent);
        }
        .github-modal .modal-list-item:hover, .github-modal .modal-list-item:focus {
            background: var(--hover-bg);
            color: var(--text-main); /* Keep main text color */
        }
        .github-modal .modal-list-item:hover strong {
            color: var(--accent); /* Highlight title on hover */
        }
        .github-modal .modal-list-item-desc {
            font-size: 0.9em;
            color: var(--text-muted);
        }
        .github-modal .modal-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            gap: 16px;
            flex-grow: 1;
        }
        .github-modal .spinner {
            width: 48px;
            height: 48px;
            border: 5px solid var(--border-main);
            border-bottom-color: var(--accent);
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ensure modal-loading and fun-message have a fixed width and wrap text */
        .modal-loading {
            min-width: 260px;
            max-width: 340px;
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            margin: 0 auto;
        }
        #fun-message {
            display: block;
            min-width: 220px;
            max-width: 320px;
            margin: 0 auto;
            word-break: break-word;
            white-space: normal;
        }

        .modal, .modal-loading {
            min-width: 360px;
            max-width: 450px;
            width: 100%;
        }

        /* Revamped Footer */
        .site-footer {
            background: var(--bg-card);
            color: var(--text-muted);
            padding: 48px 32px;
            margin-top: 40px;
            border-top: 1.5px solid var(--border-main);
            font-size: 0.98em;
            border-radius: 24px;
        }
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 32px;
        }
        .footer-column h4 {
            font-size: 1.1em;
            color: var(--text-main);
            margin-bottom: 16px;
            font-weight: 600;
        }
        .footer-column p, .footer-column ul {
            margin: 0;
            padding: 0;
            list-style: none;
            line-height: 1.7;
        }
        .footer-column a {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }
        .footer-column a:hover {
            color: var(--accent);
            text-decoration: underline;
        }
        .footer-links li {
            margin-bottom: 8px;
        }
        .footer-socials {
            display: flex;
            gap: 16px;
            margin-top: 12px;
        }
        .footer-socials a {
            color: var(--text-muted);
            font-size: 1.5em;
        }
        .footer-bottom {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border-main);
            text-align: center;
            font-size: 0.9em;
        }

        /* Aurora Background Styles - Optimized for Performance */
        #aurora-bg {
          position: fixed;
          z-index: 0;
          top: 0; left: 0; right: 0; bottom: 0;
          pointer-events: none;
          width: 100vw;
          height: 100vh;
          overflow: hidden;
          opacity: 0;
          transition: opacity 0.7s cubic-bezier(.4,2,.6,1);
          /* Disable on mobile for better performance */
          display: none;
        }
        body.aurora-enabled #aurora-bg {
          opacity: 1;
          display: block;
        }
        /* Only show aurora on desktop/larger screens */
        @media (min-width: 768px) {
          body.aurora-enabled #aurora-bg {
            display: block;
          }
        }
        /* Hide aurora completely on mobile for performance */
        @media (max-width: 767px) {
          #aurora-bg {
            display: none !important;
          }
          body.aurora-enabled #aurora-bg {
            display: none !important;
          }
        }
        #aurora-bg::before {
          content: '';
          position: absolute;
          z-index: 2;
          top: 0; left: 0; right: 0; bottom: 0;
          pointer-events: none;
          background: radial-gradient(circle at 50% 55%, rgba(20,22,34,0) 55%, rgba(20,22,34,0.7) 100%);
        }
        #aurora-bg .aurora-layer {
          position: absolute;
          width: 90vw;
          height: 90vh;
          filter: blur(120px);
          opacity: 0.15;
          pointer-events: none;
          z-index: 1;
          animation: aurora-move 40s linear infinite alternate;
          will-change: transform;
          /* Reduce animation complexity for better performance */
          transform-origin: center;
        }
        #aurora-bg .aurora1 {
          left: -20vw;
          top: -20vh;
          background: radial-gradient(ellipse 60% 40% at 30% 40%, var(--aurora1) 0%, var(--aurora2) 60%, transparent 100%);
          animation-delay: 0s;
        }
        #aurora-bg .aurora2 {
          right: -25vw;
          bottom: -25vh;
          background: radial-gradient(ellipse 50% 30% at 70% 60%, var(--aurora2) 0%, var(--aurora4) 60%, transparent 100%);
          animation-delay: 20s;
        }
        #aurora-bg .aurora3 {
          right: -15vw;
          top: -10vh;
          background: radial-gradient(ellipse 40% 60% at 60% 20%, var(--aurora3) 0%, var(--aurora1) 60%, transparent 100%);
          animation-delay: 10s;
        }
        /* Simplified animation - removed extra layers for better performance */
        @keyframes aurora-move {
          0% { 
            transform: scale(1) translateY(0) rotate(0deg); 
            filter: blur(120px);
          }
          50% { 
            transform: scale(1.05) translateY(-1vw) rotate(3deg); 
            filter: blur(130px);
          }
          100% { 
            transform: scale(1.1) translateY(1vw) rotate(-3deg); 
            filter: blur(120px);
          }
        }
        /* Reduced opacity and simplified for light themes */
        .theme-light #aurora-bg::before, .theme-solarized #aurora-bg::before {
          background: none;
        }
        .theme-light #aurora-bg .aurora-layer,
        .theme-solarized #aurora-bg .aurora-layer {
          opacity: 0.12 !important;
          filter: blur(100px) !important;
          animation: none !important;
        }
        .theme-light #aurora-bg .aurora1 {
          left: -20vw;
          top: -20vh;
          width: 120vw;
          height: 120vw;
          background: radial-gradient(ellipse 60% 40% at 30% 40%, #7ecbff 0%, #c7a4ff 80%, transparent 100%);
          display: block !important;
        }
        .theme-light #aurora-bg .aurora2 {
          right: -20vw;
          bottom: -20vh;
          width: 120vw;
          height: 120vw;
          background: radial-gradient(ellipse 60% 40% at 70% 60%, #7fffd4 0%, #e0fff7 80%, transparent 100%);
          display: block !important;
        }
        .theme-light #aurora-bg .aurora3 {
          display: none !important;
        }
        .theme-solarized #aurora-bg .aurora1 {
          left: -20vw;
          top: -20vh;
          width: 120vw;
          height: 120vw;
          background: radial-gradient(ellipse 60% 40% at 30% 40%, #6ec6e6 0%, #b7e6a5 80%, transparent 100%);
          display: block !important;
        }
        .theme-solarized #aurora-bg .aurora2 {
          right: -20vw;
          bottom: -20vh;
          width: 120vw;
          height: 120vw;
          background: radial-gradient(ellipse 60% 40% at 70% 60%, #ffe066 0%, #ffb3c6 80%, transparent 100%);
          display: block !important;
        }
        .theme-solarized #aurora-bg .aurora3 {
          display: none !important;
        }
        /* Remove noise overlay for better performance */
        /* #aurora-bg .aurora-noise {
          position: absolute;
          top: 0; left: 0; right: 0; bottom: 0;
          width: 100vw;
          height: 100vh;
          pointer-events: none;
          z-index: 3;
          opacity: 0.13;
          background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" seed="2"/></filter><rect width="100%" height="100%" filter="url(%23noise)"/></svg>');
          background-size: 200px 200px;
          mix-blend-mode: soft-light;
        } */
        .theme-solarized #aurora-bg .aurora3 {
          display: none !important;
        }
        /* Noise overlay for organic look */
        #aurora-bg .aurora-noise {
          position: absolute;
          top: 0; left: 0; right: 0; bottom: 0;
          width: 100vw;
          height: 100vh;
          pointer-events: none;
          z-index: 3;
          opacity: 0.13;
          background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" seed="2"/></filter><rect width="100%" height="100%" filter="url(%23noise)"/></svg>');
          background-size: 200px 200px;
          mix-blend-mode: soft-light;
        }
        .collapsible-title {
          display: inline-flex;
          align-items: center;
          gap: 6px;
        }
        .collapsible-chevron {
          display: inline-block;
          vertical-align: middle;
          margin-right: 4px;
        }
        #currentFileDisplay {
          max-width: 120px;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          display: inline-block;
          vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="aurora-bg">
      <div class="aurora-layer aurora1"></div>
      <div class="aurora-layer aurora2"></div>
      <div class="aurora-layer aurora3"></div>
      <div class="aurora-noise"></div>
    </div>
    <div class="container">
        <div class="header" style="position: relative;">
            <div class="theme-toggle" id="themeToggle">
                <button class="theme-toggle-btn" id="themeToggleBtn" aria-haspopup="true" aria-expanded="false" aria-label="Change theme" tabindex="0">
                    <span id="themeIcon" aria-hidden="true">
                        <svg id="icon-moon" style="display:block;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/></svg>
                        <svg id="icon-sun" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="5" stroke-width="2"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 6.95l-1.41-1.41M6.05 6.05L4.64 4.64m12.02 0l-1.41 1.41M6.05 17.95l-1.41 1.41"/></svg>
                        <svg id="icon-solar" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="6" stroke-width="2"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h2m12 0h2M12 4v2m0 12v2m7.07-7.07l-1.41-1.41M6.34 6.34L4.93 4.93m12.73 12.73l-1.41-1.41M6.34 17.66l-1.41 1.41"/></svg>
                        <svg id="icon-forest" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l2.09 6.26L20 9.27l-5 3.64L16.18 20 12 16.77 7.82 20 9 12.91l-5-3.64 5.91-.01z"/></svg>
                        <svg id="icon-ocean" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 20c1.5-2 4.5-2 6 0s4.5 2 6 0 4.5-2 6 0"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 16c1.5-2 4.5-2 6 0s4.5 2 6 0 4.5-2 6 0"/></svg>
                        <svg id="icon-cyberpunk" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="4"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10M7 12h10M7 17h6"/></svg>
                    </span>
                    <!-- <span class="theme-toggle-arrow" aria-hidden="true">▼</span> -->
                </button>
                <div class="theme-dropdown" id="themeDropdown" role="menu" aria-label="Theme selection">
                    <button class="theme-dropdown-item" data-theme="dark" role="menuitem" tabindex="0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/></svg>
                        Dark
                    </button>
                    <button class="theme-dropdown-item" data-theme="light" role="menuitem" tabindex="0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="5" stroke-width="2"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 6.95l-1.41-1.41M6.05 6.05L4.64 4.64m12.02 0l-1.41 1.41M6.05 17.95l-1.41 1.41"/></svg>
                        Light
                    </button>
                    <button class="theme-dropdown-item" data-theme="solarized" role="menuitem" tabindex="0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="6" stroke-width="2"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h2m12 0h2M12 4v2m0 12v2m7.07-7.07l-1.41-1.41M6.34 6.34L4.93 4.93m12.73 12.73l-1.41-1.41M6.34 17.66l-1.41 1.41"/></svg>
                        Solarized
                    </button>
                    <button class="theme-dropdown-item" data-theme="forest" role="menuitem" tabindex="0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l2.09 6.26L20 9.27l-5 3.64L16.18 20 12 16.77 7.82 20 9 12.91l-5-3.64 5.91-.01z"/></svg>
                        Forest
                    </button>
                    <button class="theme-dropdown-item" data-theme="ocean" role="menuitem" tabindex="0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 20c1.5-2 4.5-2 6 0s4.5 2 6 0 4.5-2 6 0"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 16c1.5-2 4.5-2 6 0s4.5 2 6 0 4.5-2 6 0"/></svg>
                        Ocean
                    </button>
                    <button class="theme-dropdown-item" data-theme="cyberpunk" role="menuitem" tabindex="0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="4"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10M7 12h10M7 17h6"/></svg>
                        Cyberpunk
                    </button>
                    <hr style="border:none; border-top:1px solid var(--border-main); margin: 6px 0 6px 0;">
                    <button class="theme-dropdown-item" id="auroraToggleBtn" tabindex="0" style="display:flex;align-items:center;gap:10px;">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width:1.2em;height:1.2em;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                      <span>Aurora Background</span>
                      <span id="auroraToggleSwitch" style="margin-left:auto;display:inline-block;width:36px;height:20px;background:var(--bg-accent);border-radius:12px;position:relative;vertical-align:middle;transition:background 0.2s;"><span style="position:absolute;top:2px;left:2px;width:16px;height:16px;border-radius:50%;background:var(--accent);transition:left 0.2s;"></span></span>
                      <span id="auroraMobileIndicator" style="font-size:0.8em;color:var(--text-muted);display:none;">(Mobile disabled)</span>
                    </button>
                </div>
            </div>
            <h1>🏢 LeetCode Company Questions</h1>
            <h2 style="text-align:center; color:var(--text-muted); font-size:1.2em; font-weight:500; margin-top:-10px;">Company-wise Interview Questions and Solutions for Software Engineering Interviews</h2>
            <p style="text-align:center; color:var(--text-muted); font-size:1rem; margin-top:10px; max-width:800px; margin-left:auto; margin-right:auto;">
                Prepare for FAANG, Microsoft, Apple, Netflix, and other top tech companies with our comprehensive collection of LeetCode questions organized by company. Track your progress, visualize completion rates, and save your practice sessions for better interview preparation.
            </p>
        </div>

        <div class="upload-section">
            <h2 style="margin-bottom: 20px;">Browse</h2>
            <button id="githubBrowseBtn" class="reset-btn" style="background: var(--bg-card); color: var(--text-muted); font-size: 1.1rem; font-weight: 600; margin-bottom: 18px;">Click To Browse Company Questions</button>
            <div id="githubModal" style="display:none;"></div>
            <hr class="themed-hr">
            <div id="savedFilesSection">
                <h2>Your Saved Files</h2>
                <div id="savedFilesList" style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <!-- Saved files will be dynamically added here -->
                </div>
            </div>
            <div class="advanced-features collapsed" id="advancedFeatures">
                <div class="advanced-header"><span class="advanced-chevron">▶</span> Upload Your Own CSV File</div>
                <div class="advanced-content">
                    <div style="margin-bottom: 12px; color: #a1a1aa; font-size: 1.01em;">
                        <span>Want to track your own set of LeetCode questions? Upload a custom CSV file below and save it for progress tracking.</span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 18px; align-items: flex-end; margin-bottom: 10px;">
                        <div class="file-input-wrapper" style="margin-bottom: 0;">
                            <input type="file" id="csvFile" accept=".csv" />
                            <span>Select File</span>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <input type="text" id="fileNameInput" placeholder="Enter file name (required to save)" 
                                style="padding: 10px; border: 2px solid #23232b; background: #23232b; color: #f4f4f5; border-radius: 8px; font-size: 1em;">
                            <button id="saveFileBtn" style="display: none; background: #10b981; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 500;">
                                💾 Save File
                            </button>
                        </div>
                    </div>
                    <div style="margin-top: 8px; color: #6366f1; font-size: 0.97em;">
                        <span>CSV columns required: <b>ID, Title, Acceptance, Difficulty, Frequency, Leetcode Question Link</b></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="statsSection" class="collapsible-section stats-card collapsed">
            <div class="collapsible-header"><span class="collapsible-chevron">▶</span> Stats</div>
            <div class="collapsible-content">
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-number completed" id="completedCount">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCount">0</div>
                        <div class="stat-label">Total Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number easy" id="easyCount">0</div>
                        <div class="stat-label">Easy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number medium" id="mediumCount">0</div>
                        <div class="stat-label">Medium</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number hard" id="hardCount">0</div>
                        <div class="stat-label">Hard</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="chartSection" class="collapsible-section collapsed" hidden>
            <div class="collapsible-header"><span class="collapsible-chevron">▶</span> Progress Visulalized</div>
            <div class="collapsible-content">
                <div class="chart-container refined-charts">
                    <div class="chart-card" style="max-width: 320px; min-width: 220px;">
                        <h3 class="chart-title">Bar: Completed vs Remaining</h3>
                        <canvas id="progressChart" width="260" height="200"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Doughnut: Completion by Difficulty</h3>
                        <canvas id="doughnutChart" width="220" height="220"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Line: Cumulative Progress Over Time</h3>
                        <canvas id="lineChart" width="420" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="controlsSection" class="collapsible-section controls-card collapsed">
            <div class="collapsible-header"><span class="collapsible-chevron">▶</span> Filters & Controls</div>
            <div class="collapsible-content">
                <div class="filter-controls-group">
                    <div class="filter-group">
                        <label>Difficulty:</label>
                        <select id="difficultyFilter">
                            <option value="">All Difficulties</option>
                            <option value="Easy">Easy</option>
                            <option value="Medium">Medium</option>
                            <option value="Hard">Hard</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="statusFilter">
                            <option value="">All Status</option>
                            <option value="completed">Completed</option>
                            <option value="pending">Not Completed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="hideDifficultyCheckbox" class="checkbox">
                                <label for="hideDifficultyCheckbox" style="cursor: pointer; user-select: none;">Hide Difficulty</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="hideIdCheckbox" class="checkbox">
                                <label for="hideIdCheckbox" style="cursor: pointer; user-select: none;">Hide ID</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="hideAcceptanceCheckbox" class="checkbox">
                                <label for="hideAcceptanceCheckbox" style="cursor: pointer; user-select: none;">Hide Acceptance</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="hideFrequencyCheckbox" class="checkbox">
                                <label for="hideFrequencyCheckbox" style="cursor: pointer; user-select: none;">Hide Frequency</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="filter-search-group">
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="searchInput" placeholder="Search questions...">
                    </div>
                </div>
                <div class="filter-actions-group">
                    <button class="reset-btn" onclick="resetProgress()">🔄 Reset Current Progress</button>
                    <button class="reset-btn" onclick="exportProgress()" style="background: #059669;">📥 Export Progress</button>
                    <button class="reset-btn" onclick="importProgress()" style="background: #7c3aed;">📤 Import Progress</button>
                </div>
            </div>
        </div>

        <div id="questionsSection" class="questions-table collapsible-section">
            <div class="collapsible-header" style="display: flex; justify-content: space-between; align-items: center; position: relative;">
                <span class="collapsible-title"><span class="collapsible-chevron">▶</span> Questions List</span>
                <span id="currentFileDisplay" style="position: absolute; left: 50%; transform: translateX(-50%); font-weight: 600; color: var(--accent); white-space: nowrap; cursor: pointer;"></span>
                <button class="reset-btn" id="zenModeBtn" type="button" style="background: #23232b; color: #f4f4f5; margin-left: auto; font-size: 1.15em; padding: 7px 12px; min-width: 0; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;" title="Toggle Full Screen">🗖</button>
            </div>
            <div class="collapsible-content">
                <div id="questionsContainer">
                    <div class="no-data">No data available. Please upload a CSV file.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal Dialog -->
    <div id="customModalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.45); z-index:2000; align-items:center; justify-content:center;">
      <div id="customModal" style="background:var(--bg-card); color:var(--text-main); border-radius:14px; box-shadow:0 8px 32px #00000044; padding:32px 28px 24px 28px; min-width:320px; max-width:90vw; max-height:80vh; display:flex; flex-direction:column; align-items:center; border:1.5px solid var(--border-main);">
        <div id="customModalMessage" style="font-size:1.08rem; margin-bottom:24px; text-align:center;"></div>
        <div id="customModalButtons" style="display:flex; gap:16px;"></div>
      </div>
    </div>

    <script>
        let questionsData = [];
        let completedQuestions = new Set();
        let chart = null;
        let doughnutChart = null;
        let lineChart = null;
        let savedFiles = new Map(); // Store saved files with their data and progress
        let currentFileName = '';
        let currentFileData = null;
        let currentQuestionsPage = 1;
        const QUESTIONS_PER_PAGE = 10; // Number of questions per page in the table
        function getPageKey(fileName) {
            return 'leetcode_page_' + fileName;
        }

        // Check if localStorage is available, fallback to cookies if not
        function isLocalStorageAvailable() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return true;
            } catch (e) {
                return false;
            }
        }

        // Storage wrapper that works with localStorage or cookies
        const persistentStorage = {
            setItem: function(key, value) {
                if (isLocalStorageAvailable()) {
                    localStorage.setItem(key, value);
                } else {
                    // Fallback to cookies for long-term storage
                    const expires = new Date();
                    expires.setTime(expires.getTime() + (365 * 24 * 60 * 60 * 1000)); // 1 year
                    document.cookie = `${key}=${encodeURIComponent(value)};expires=${expires.toUTCString()};path=/`;
                }
            },
            
            getItem: function(key) {
                if (isLocalStorageAvailable()) {
                    return localStorage.getItem(key);
                } else {
                    // Fallback to cookies
                    const name = key + "=";
                    const decodedCookie = decodeURIComponent(document.cookie);
                    const ca = decodedCookie.split(';');
                    for (let i = 0; i < ca.length; i++) {
                        let c = ca[i];
                        while (c.charAt(0) === ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) === 0) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return null;
                }
            },
            
            removeItem: function(key) {
                if (isLocalStorageAvailable()) {
                    localStorage.removeItem(key);
                } else {
                    // Remove cookie by setting expired date
                    document.cookie = `${key}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
                }
            }
        };

        // Load completed questions and saved files
        function loadCompletedQuestions() {
            try {
                const saved = persistentStorage.getItem('leetcode_completed_' + currentFileName);
                if (saved) {
                    completedQuestions = new Set(JSON.parse(saved));
                }
            } catch (e) {
                console.log('No saved progress found for', currentFileName);
                completedQuestions = new Set();
            }
        }

        // Save completed questions
        function saveCompletedQuestions() {
            if (currentFileName) {
                try {
                    persistentStorage.setItem('leetcode_completed_' + currentFileName, JSON.stringify([...completedQuestions]));
                    
                    // Also update the saved file's progress
                    if (savedFiles.has(currentFileName)) {
                        const fileInfo = savedFiles.get(currentFileName);
                        fileInfo.progress = [...completedQuestions];
                        fileInfo.lastUpdated = new Date().toISOString();
                        saveSavedFiles();
                    }
                } catch (e) {
                    console.error('Error saving progress:', e);
                }
            }
        }

        // Load saved files from persistent storage
        function loadSavedFiles() {
            try {
                const saved = persistentStorage.getItem('leetcode_saved_files');
                if (saved) {
                    const filesArray = JSON.parse(saved);
                    savedFiles = new Map(filesArray);
                    displaySavedFiles();
                }
            } catch (e) {
                console.log('No saved files found');
                savedFiles = new Map();
            }
        }

        // Save files to persistent storage
        function saveSavedFiles() {
            try {
                persistentStorage.setItem('leetcode_saved_files', JSON.stringify([...savedFiles]));
            } catch (e) {
                console.error('Error saving files:', e);
            }
        }

        // Add this mapping function before any CSV parsing logic:
        function mapCSVRow(row, idx) {
            // Normalize keys: trim whitespace from all keys
            const cleanRow = {};
            for (const key in row) {
                if (Object.hasOwn(row, key)) {
                    cleanRow[key.trim()] = row[key];
                }
            }
            // Normalize difficulty
            let difficulty = (cleanRow['Difficulty'] || '').toLowerCase();
            if (difficulty === 'easy') difficulty = 'Easy';
            else if (difficulty === 'medium') difficulty = 'Medium';
            else if (difficulty === 'hard') difficulty = 'Hard';
            else difficulty = '';

            // Format acceptance rate as percentage string
            let acceptance = '';
            if (cleanRow['Acceptance Rate'] !== undefined && cleanRow['Acceptance Rate'] !== '') {
                let val = parseFloat(cleanRow['Acceptance Rate']);
                if (!isNaN(val)) acceptance = (val * 100).toFixed(1) + '%';
            }

            return {
                ID: idx + 1,
                Title: cleanRow['Title'] || '',
                Acceptance: acceptance,
                Difficulty: difficulty,
                Frequency: cleanRow['Frequency'] || '',
                'Leetcode Question Link': cleanRow['Leetcode Question Link'] || cleanRow['Link'] || '',
                Topics: cleanRow['Topics'] || ''
            };
        }

        document.getElementById('csvFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                // Update button text to show selected file
                const wrapper = document.querySelector('.file-input-wrapper span');
                wrapper.textContent = `Selected: ${file.name}`;
                
                // Show save button and set default file name
                document.getElementById('saveFileBtn').style.display = 'inline-block';
                document.getElementById('fileNameInput').value = file.name.replace('.csv', '');
                
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        // Map to internal format
                        currentFileData = results.data.map(mapCSVRow);
                        questionsData = currentFileData;
                        // Remove .csv and any leading numbers/dots/spaces
                        currentFileName = file.name.replace('.csv', '').replace(/^\d+\.\s*/, '');
                        updateCurrentFileDisplay();
                        loadCompletedQuestions();
                        updateDisplay();
                        showSections();
                    },
                    error: function(error) {
                        alert('Error parsing CSV: ' + error.message);
                        // Reset button text on error
                        wrapper.textContent = 'Select File';
                        document.getElementById('saveFileBtn').style.display = 'none';
                    }
                });
            }
        });

        // Save file button event
        document.getElementById('saveFileBtn').addEventListener('click', function() {
            const customName = document.getElementById('fileNameInput').value.trim();
            if (!customName) {
                alert('Please enter a file name');
                return;
            }
            
            if (!currentFileData) {
                alert('No file data to save');
                return;
            }

            // Check if name already exists
            const existingNames = [...savedFiles.keys()];
            if (existingNames.includes(customName)) {
                if (!confirm('A file with this name already exists. Do you want to replace it?')) {
                    return;
                }
            }

            // Save the file
            savedFiles.set(customName, {
                data: currentFileData,
                progress: [...completedQuestions],
                uploadDate: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                originalName: document.getElementById('csvFile').files[0]?.name || 'Unknown'
            });

            currentFileName = customName;
            saveSavedFiles();
            displaySavedFiles();
            
            // Hide save button after saving
            document.getElementById('saveFileBtn').style.display = 'none';
            alert('File saved successfully!');

            // Update last selected file
            persistentStorage.setItem('leetcode_last_selected_file', customName);
        });

        function displaySavedFiles() {
            const container = document.getElementById('savedFilesList');
            const section = document.getElementById('savedFilesSection');
            if (!container || !section) return;
            if (savedFiles.size === 0) {
                section.style.display = 'none';
                return;
            }
            section.style.display = 'block';
            container.innerHTML = '';
            
            [...savedFiles.entries()].forEach(([fileName, fileInfo]) => {
                const loadBtn = document.createElement('button');
                loadBtn.className = 'saved-file-btn' + (currentFileName === fileName ? ' active' : '');
                loadBtn.onclick = () => loadSavedFile(fileName);

                // Show completed/total
                const total = fileInfo.data ? fileInfo.data.length : 0;
                function capitalizeWords(str) {
                    return str.replace(/\b\w/g, c => c.toUpperCase());
                }
                function addSpaceBeforeYear(str) {
                    // Replace underscores with spaces for display
                    str = str.replace(/_/g, ' ');
                    // Add a space before a 4-digit year at the end of the string, e.g., 'Summer2023' -> 'Summer 2023'
                    str = str.replace(/(\D)(\d{4})$/, '$1 $2');
                    // Add a space between numbers and letters (e.g., 6months -> 6 Months, 1year -> 1 Year)
                    str = str.replace(/(\d+)([a-zA-Z]+)/g, '$1 $2');
                    // Special case: Alltime -> All Time
                    str = str.replace(/Alltime/i, 'All Time');
                    // Special case: 6months -> 6 Months, 1year -> 1 Year (already handled by previous regex, but ensure capitalization)
                    return str;
                }
                let completed = 0;
                if (fileInfo.progress && fileInfo.data) {
                    // Only count as completed those IDs that exist in the file's questions
                    const validIds = new Set(fileInfo.data.filter(q => q.ID != null).map(q => q.ID.toString()));
                    completed = fileInfo.progress.filter(id => validIds.has(id?.toString())).length;
                }
                let displayName = addSpaceBeforeYear(capitalizeWords(fileName));

                const contentSpan = document.createElement('span');
                contentSpan.style.cssText = 'display: flex; flex-direction: column; text-align: left; width: 100%; gap: 4px;';
                contentSpan.innerHTML = `
                    <div style="display: flex; align-items: flex-start; gap: 6px;">
                        <span>📄</span>
                        <span style="word-break: break-word;">${displayName}</span>
                    </div>
                    <div hidden style="height: 1px; background: var(--divider); width: calc(100% + 48px + 18px); margin-left: -18px; opacity: 0.7;"></div>
                    <span class="saved-file-progress-pill" style="margin-top: 10px; width:fit-content">${completed} / ${total}</span>
                `;
                loadBtn.appendChild(contentSpan);

                // Three-dots menu
                const menuActions = document.createElement('div');
                menuActions.className = 'file-actions';
                const menuBtn = document.createElement('button');
                menuBtn.className = 'file-menu-btn';
                menuBtn.innerHTML = '⋯';
                menuBtn.title = 'File actions';
                menuActions.appendChild(menuBtn);
                // Popover
                const menuPopover = document.createElement('div');
                menuPopover.className = 'file-menu-popover';
                menuPopover.innerHTML = `<button class="file-menu-item" type="button">Delete</button>`;
                menuActions.appendChild(menuPopover);

                // Show/hide popover logic
                menuBtn.onclick = (e) => {
                    e.stopPropagation();
                    // Close all other popovers
                    document.querySelectorAll('.file-menu-popover').forEach(pop => pop.classList.remove('show'));
                    menuPopover.classList.toggle('show');
                    // Add a one-time event listener to close on outside click
                    function closeMenu(e) {
                        if (!menuActions.contains(e.target)) {
                            menuPopover.classList.remove('show');
                            document.removeEventListener('mousedown', closeMenu);
                        }
                    }
                    setTimeout(() => {
                        document.addEventListener('mousedown', closeMenu);
                    }, 0);
                };

                // Delete action
                menuPopover.querySelector('.file-menu-item').onclick = (e) => {
                    e.stopPropagation();
                    menuPopover.classList.remove('show');
                    deleteSavedFile(fileName);
                };

                loadBtn.appendChild(menuActions);
                container.appendChild(loadBtn);
            });
        }

        function loadSavedFile(fileName) {
            if (!savedFiles.has(fileName)) {
                alert('File not found');
                return;
            }
            
            const fileInfo = savedFiles.get(fileName);
            questionsData = fileInfo.data;
            currentFileName = fileName;
            currentFileData = fileInfo.data;
            completedQuestions = new Set(fileInfo.progress || []);
            
            // Restore page for this file
            const savedPage = persistentStorage.getItem(getPageKey(fileName));
            if (savedPage && !isNaN(Number(savedPage))) {
                currentQuestionsPage = Number(savedPage);
            } else {
                currentQuestionsPage = 1;
            }
            updateDisplay();
            showSections();
            displaySavedFiles(); // Update active state
            
            // Update file input display
            const wrapper = document.querySelector('.file-input-wrapper span');
            wrapper.textContent = 'Select File';
            document.getElementById('saveFileBtn').style.display = 'none';

            // Update last selected file
            persistentStorage.setItem('leetcode_last_selected_file', fileName);
            updateCurrentFileDisplay();
        }

        function deleteSavedFile(fileName) {
            if (confirm(`Are you sure you want to delete "${fileName}"? This cannot be undone.`)) {
                savedFiles.delete(fileName);
                persistentStorage.removeItem('leetcode_completed_' + fileName);
                saveSavedFiles();
                displaySavedFiles();
                
                // If we deleted the currently active file, clear the display
                if (currentFileName === fileName) {
                    currentFileName = '';
                    currentFileData = null;
                    questionsData = [];
                    completedQuestions.clear();
                    hideSections();
                    const wrapper = document.querySelector('.file-input-wrapper span');
                    wrapper.textContent = 'Select File';
                }

                // If the deleted file was the last selected, remove the key
                if (currentFileName === fileName) {
                    persistentStorage.removeItem('leetcode_last_selected_file');
                }
                updateCurrentFileDisplay();
            }
        }

        function showSections() {
            document.getElementById('statsSection').classList.remove('collapsed');
            document.getElementById('chartSection').classList.remove('collapsed');
            document.getElementById('controlsSection').classList.remove('collapsed');
            document.getElementById('questionsSection').classList.remove('collapsed');
        }

        function hideSections() {
            document.getElementById('statsSection').classList.add('collapsed');
            document.getElementById('chartSection').classList.add('collapsed');
            document.getElementById('controlsSection').classList.add('collapsed');
            document.getElementById('questionsSection').classList.add('collapsed');
        }

        function updateDisplay() {
            updateStats();
            updateChart();
            renderQuestions();
        }

        function updateStats() {
            const total = questionsData.length;
            // Only count as completed those IDs that exist in the current questionsData
            const validIds = new Set(questionsData.filter(q => q.ID != null).map(q => q.ID.toString()));
            const completed = Array.from(completedQuestions).filter(id => validIds.has(id?.toString())).length;
            const easy = questionsData.filter(q => q.Difficulty === 'Easy').length;
            const medium = questionsData.filter(q => q.Difficulty === 'Medium').length;
            const hard = questionsData.filter(q => q.Difficulty === 'Hard').length;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('easyCount').textContent = easy;
            document.getElementById('mediumCount').textContent = medium;
            document.getElementById('hardCount').textContent = hard;
        }

        function getThemeVar(name) {
            return getComputedStyle(document.body).getPropertyValue(name).trim();
        }

        function updateChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            const doughnutCtx = document.getElementById('doughnutChart').getContext('2d');
            const lineCtx = document.getElementById('lineChart').getContext('2d');
            const easyColor = getThemeVar('--accent2');
            const mediumColor = getThemeVar('--accent3');
            const hardColor = getThemeVar('--accent4');
            const accentColor = getThemeVar('--accent');
            const cardBg = getThemeVar('--bg-card');
            const borderMain = getThemeVar('--border-main');
            const textMuted = getThemeVar('--text-muted');
            const textMain = getThemeVar('--text-main');
            const easyTotal = questionsData.filter(q => q.Difficulty === 'Easy').length;
            const mediumTotal = questionsData.filter(q => q.Difficulty === 'Medium').length;
            const hardTotal = questionsData.filter(q => q.Difficulty === 'Hard').length;
            const easyCompleted = questionsData.filter(q => 
                q.Difficulty === 'Easy' && q.ID != null && completedQuestions.has(q.ID.toString())
            ).length;
            const mediumCompleted = questionsData.filter(q => 
                q.Difficulty === 'Medium' && q.ID != null && completedQuestions.has(q.ID.toString())
            ).length;
            const hardCompleted = questionsData.filter(q => 
                q.Difficulty === 'Hard' && q.ID != null && completedQuestions.has(q.ID.toString())
            ).length;

            if (chart) chart.destroy();
            if (doughnutChart) doughnutChart.destroy();
            if (lineChart) lineChart.destroy();

            // Bar Chart
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Easy', 'Medium', 'Hard'],
                    datasets: [
                        {
                            label: 'Completed',
                            data: [easyCompleted, mediumCompleted, hardCompleted],
                            backgroundColor: [easyColor, mediumColor, hardColor],
                            borderRadius: 16,
                            borderSkipped: false,
                            barPercentage: 0.55,
                            categoryPercentage: 0.55,
                            borderWidth: 0,
                        },
                        {
                            label: 'Remaining',
                            data: [easyTotal - easyCompleted, mediumTotal - mediumCompleted, hardTotal - hardCompleted],
                            backgroundColor: [accentColor, accentColor, accentColor],
                            borderRadius: 16,
                            borderSkipped: false,
                            barPercentage: 0.55,
                            categoryPercentage: 0.55,
                            borderWidth: 0,
                        }
                    ]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textMuted,
                                font: { family: 'inherit', size: 13, weight: 500 },
                                boxWidth: 16,
                                boxHeight: 16,
                                padding: 18
                            }
                        },
                        title: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: cardBg,
                            titleColor: textMain,
                            bodyColor: textMain,
                            borderColor: borderMain,
                            borderWidth: 1,
                            padding: 12,
                            caretSize: 6,
                            cornerRadius: 8
                        }
                    },
                    layout: {
                        padding: 10
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: textMuted,
                                font: { family: 'inherit', size: 13 }
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: borderMain,
                                borderColor: borderMain,
                                drawBorder: false,
                                lineWidth: 1.2
                            },
                            ticks: {
                                color: textMuted,
                                font: { family: 'inherit', size: 13 },
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Doughnut Chart
            doughnutChart = new Chart(doughnutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Easy', 'Medium', 'Hard'],
                    datasets: [{
                        data: [easyCompleted, mediumCompleted, hardCompleted],
                        backgroundColor: [easyColor, mediumColor, hardColor],
                        borderColor: borderMain,
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textMuted,
                                font: { family: 'inherit', size: 13 }
                            }
                        },
                        tooltip: {
                            backgroundColor: cardBg,
                            titleColor: textMain,
                            bodyColor: textMain,
                            borderColor: borderMain,
                            borderWidth: 1,
                        }
                    }
                }
            });

            // Line Chart (Cumulative Progress Over Time)
            // Build a timeline of completion
            let progressTimeline = [];
            if (questionsData.length > 0 && savedFiles.has(currentFileName)) {
                const fileInfo = savedFiles.get(currentFileName);
                if (fileInfo.progressHistory) {
                    progressTimeline = fileInfo.progressHistory;
                } else if (fileInfo.progress) {
                    // Fallback: just show current progress as a flat line
                    progressTimeline = [{ date: fileInfo.lastUpdated || fileInfo.uploadDate, completed: fileInfo.progress.length }];
                }
            }
            // If no timeline, show a flat line
            if (progressTimeline.length === 0) {
                progressTimeline = [{ date: new Date().toISOString(), completed: easyCompleted + mediumCompleted + hardCompleted }];
            }
            // Format for chart.js
            const lineLabels = progressTimeline.map(p => new Date(p.date).toLocaleDateString());
            const lineData = progressTimeline.map(p => p.completed);
            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: lineLabels,
                    datasets: [{
                        label: 'Cumulative Completed',
                        data: lineData,
                        fill: true,
                        borderColor: accentColor,
                        backgroundColor: accentColor + '22', // 13% opacity
                        tension: 0.3,
                        pointRadius: 3,
                        pointBackgroundColor: accentColor,
                        pointBorderColor: borderMain,
                        pointHoverRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: cardBg,
                            titleColor: textMain,
                            bodyColor: textMain,
                            borderColor: borderMain,
                            borderWidth: 1,
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: borderMain, drawBorder: false },
                            ticks: { color: textMuted, font: { family: 'inherit', size: 12 } }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: borderMain, drawBorder: false },
                            ticks: { color: textMuted, font: { family: 'inherit', size: 12 } }
                        }
                    }
                }
            });
        }

        function renderQuestions() {
            // Restore page for current file if available
            if (currentFileName) {
                const savedPage = persistentStorage.getItem(getPageKey(currentFileName));
                if (savedPage && !isNaN(Number(savedPage))) {
                    currentQuestionsPage = Number(savedPage);
                }
            }
            const container = document.getElementById('questionsContainer');
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const hideDifficulty = document.getElementById('hideDifficultyCheckbox').checked;
            const hideId = document.getElementById('hideIdCheckbox')?.checked;
            const hideAcceptance = document.getElementById('hideAcceptanceCheckbox')?.checked;
            const hideFrequency = document.getElementById('hideFrequencyCheckbox')?.checked;

            let filteredQuestions = questionsData.filter(question => {
                const matchesDifficulty = !difficultyFilter || question.Difficulty === difficultyFilter;
                const isCompleted = question.ID != null && completedQuestions.has(question.ID.toString());
                const matchesStatus = !statusFilter || 
                    (statusFilter === 'completed' && isCompleted) ||
                    (statusFilter === 'pending' && !isCompleted);
                const matchesSearch = !searchQuery || 
                    (question.Title && question.Title.toLowerCase().includes(searchQuery)) ||
                    (question.ID != null && question.ID.toString().includes(searchQuery));

                return matchesDifficulty && matchesStatus && matchesSearch;
            });

            // Paging logic
            const totalPages = Math.max(1, Math.ceil(filteredQuestions.length / QUESTIONS_PER_PAGE));
            if (currentQuestionsPage > totalPages) currentQuestionsPage = totalPages;
            const startIdx = (currentQuestionsPage - 1) * QUESTIONS_PER_PAGE;
            const endIdx = startIdx + QUESTIONS_PER_PAGE;
            const pageQuestions = filteredQuestions.slice(startIdx, endIdx);

            if (filteredQuestions.length === 0) {
                container.innerHTML = '<div class="no-data">No questions match your filters.</div>';
                return;
            }

            const maxFrequency = Math.max(...questionsData.map(q => q.Frequency || 0));

            const tableHTML = `
                <div class="questions-table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>✓</th>
                                ${!hideId ? '<th>ID</th>' : ''}
                                <th>Title</th>
                                ${!hideDifficulty ? '<th>Difficulty</th>' : ''}
                                ${!hideAcceptance ? '<th>Acceptance</th>' : ''}
                                ${!hideFrequency ? '<th>Frequency</th>' : ''}
                            </tr>
                        </thead>
                        <tbody>
                            ${pageQuestions.map(question => {
                                const isCompleted = question.ID != null && completedQuestions.has(question.ID.toString());
                                const frequencyWidth = maxFrequency > 0 ? (question.Frequency / maxFrequency) * 100 : 0;
                                
                                return `
                                    <tr class="${isCompleted ? 'question-row-completed' : ''}">
                                        <td><label class="checkbox-label"><input type="checkbox" class="checkbox" 
                                                   ${isCompleted ? 'checked' : ''} 
                                                   onchange="toggleQuestion(${question.ID != null ? question.ID : 'null'})"></label></td>
                                        ${!hideId ? `<td class="question-id">${question.ID != null ? question.ID : ''}</td>` : ''}
                                        <td><a href="${question['Leetcode Question Link']}" target="_blank" class="question-title">${question.Title || ''}</a></td>
                                        ${!hideDifficulty ? `<td>
                                            <span class="difficulty-badge difficulty-${question.Difficulty ? question.Difficulty.toLowerCase() : ''}">
                                                ${question.Difficulty || ''}
                                            </span>
                                        </td>` : ''}
                                        ${!hideAcceptance ? `<td class="acceptance-rate">${question.Acceptance || ''}</td>` : ''}
                                        ${!hideFrequency ? `<td>
                                            <div class="frequency-bar">
                                                <div class="frequency-fill" style="width: ${frequencyWidth}%"></div>
                                            </div>
                                        </td>` : ''}
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            // Pagination controls
            let paginationHTML = '';
            if (totalPages > 1) {
                paginationHTML = '<div class="pagination">';
                paginationHTML += `<button class="pagination-btn" ${currentQuestionsPage === 1 ? 'disabled' : ''} onclick="window.changeQuestionsPage(${currentQuestionsPage - 1})">Prev</button>`;
                // Always show page 1
                paginationHTML += `<button class="pagination-btn${currentQuestionsPage === 1 ? ' active' : ''}" onclick="window.changeQuestionsPage(1)">1</button>`;
                // Ellipsis after 1 if needed
                if (currentQuestionsPage > 4) {
                    paginationHTML += `<span style='padding:0 6px;color:var(--text-muted);user-select:none;'>...</span>`;
                }
                // Pages around current
                for (let i = Math.max(2, currentQuestionsPage - 2); i <= Math.min(totalPages - 1, currentQuestionsPage + 2); i++) {
                    paginationHTML += `<button class="pagination-btn${i === currentQuestionsPage ? ' active' : ''}" onclick="window.changeQuestionsPage(${i})">${i}</button>`;
                }
                // Ellipsis before last if needed
                if (currentQuestionsPage < totalPages - 3) {
                    paginationHTML += `<span style='padding:0 6px;color:var(--text-muted);user-select:none;'>...</span>`;
                }
                // Always show last page if more than 1
                if (totalPages > 1) {
                    paginationHTML += `<button class="pagination-btn${currentQuestionsPage === totalPages ? ' active' : ''}" onclick="window.changeQuestionsPage(${totalPages})">${totalPages}</button>`;
                }
                paginationHTML += `<button class="pagination-btn" ${currentQuestionsPage === totalPages ? 'disabled' : ''} onclick="window.changeQuestionsPage(${currentQuestionsPage + 1})">Next</button>`;
                paginationHTML += '</div>';
            }
            container.innerHTML = tableHTML + paginationHTML;
        }

        function toggleQuestion(id) {
            if (id == null) return;
            const idStr = id.toString();
            if (completedQuestions.has(idStr)) {
                completedQuestions.delete(idStr);
            } else {
                completedQuestions.add(idStr);
            }
            saveCompletedQuestions();
            updateDisplay();
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset progress for the current file? This cannot be undone.')) {
                completedQuestions.clear();
                saveCompletedQuestions();
                updateDisplay();
            }
        }

        function exportProgress() {
            if (!currentFileName) {
                alert('No file is currently loaded');
                return;
            }
            
            const exportData = {
                fileName: currentFileName,
                completedQuestions: [...completedQuestions],
                exportDate: new Date().toISOString(),
                totalQuestions: questionsData.length
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `leetcode_progress_${currentFileName}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function importProgress() {
            if (!currentFileName) {
                alert('Please load a file first before importing progress');
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importData = JSON.parse(e.target.result);
                            if (importData.completedQuestions && Array.isArray(importData.completedQuestions)) {
                                if (confirm(`Import ${importData.completedQuestions.length} completed questions? This will replace your current progress.`)) {
                                    completedQuestions = new Set(importData.completedQuestions);
                                    saveCompletedQuestions();
                                    updateDisplay();
                                    alert('Progress imported successfully!');
                                }
                            } else {
                                alert('Invalid progress file format');
                            }
                        } catch (error) {
                            alert('Error reading progress file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Add event listeners for filters
        document.getElementById('difficultyFilter').addEventListener('change', renderQuestions);
        document.getElementById('statusFilter').addEventListener('change', renderQuestions);
        document.getElementById('searchInput').addEventListener('input', renderQuestions);
        document.getElementById('hideDifficultyCheckbox').addEventListener('change', function() {
            const difficultyFilter = document.getElementById('difficultyFilter');
            difficultyFilter.disabled = this.checked;
            if (this.checked) {
                difficultyFilter.value = '';
            }
            persistentStorage.setItem('leetcode_hide_difficulty', String(this.checked));
            renderQuestions();
        });
        document.getElementById('hideIdCheckbox').addEventListener('change', function() {
            persistentStorage.setItem('leetcode_hide_id', String(this.checked));
            renderQuestions();
        });
        document.getElementById('hideAcceptanceCheckbox').addEventListener('change', function() {
            persistentStorage.setItem('leetcode_hide_acceptance', String(this.checked));
            renderQuestions();
        });
        document.getElementById('hideFrequencyCheckbox').addEventListener('change', function() {
            persistentStorage.setItem('leetcode_hide_frequency', String(this.checked));
            renderQuestions();
        });

        // Initialize
        loadSavedFiles();
        displaySavedFiles();

        // Restore hide difficulty state
        const hideDifficultySaved = persistentStorage.getItem('leetcode_hide_difficulty') === 'true';
        const hideCheckbox = document.getElementById('hideDifficultyCheckbox');
        const difficultyFilterInput = document.getElementById('difficultyFilter');
        hideCheckbox.checked = hideDifficultySaved;
        difficultyFilterInput.disabled = hideDifficultySaved;
        if (hideDifficultySaved) {
            difficultyFilterInput.value = '';
        }

        // Restore hide states on load
        const hideIdSaved = persistentStorage.getItem('leetcode_hide_id') === 'true';
        const hideAcceptanceSaved = persistentStorage.getItem('leetcode_hide_acceptance') === 'true';
        const hideFrequencySaved = persistentStorage.getItem('leetcode_hide_frequency') === 'true';
        document.getElementById('hideIdCheckbox').checked = hideIdSaved;
        document.getElementById('hideAcceptanceCheckbox').checked = hideAcceptanceSaved;
        document.getElementById('hideFrequencyCheckbox').checked = hideFrequencySaved;

        // Collapsible section toggling
        window.addEventListener('DOMContentLoaded', function() {
            // Ensure only Questions List is open by default
            document.getElementById('statsSection').classList.add('collapsed');
            document.getElementById('chartSection').classList.add('collapsed');
            document.getElementById('controlsSection').classList.add('collapsed');
            document.getElementById('questionsSection').classList.remove('collapsed');
            // Collapsible logic
            document.querySelectorAll('.collapsible-header').forEach(header => {
                header.addEventListener('click', function() {
                    const section = header.closest('.collapsible-section');
                    section.classList.toggle('collapsed');
                });
                header.setAttribute('tabindex', '0');
                header.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        header.click();
                    }
                });
            });
            // Advanced features toggle (with null check)
            const adv = document.getElementById('advancedFeatures');
            if (adv) {
                const advHeader = adv.querySelector('.advanced-header');
                if (advHeader) {
                    advHeader.addEventListener('click', function() {
                        adv.classList.toggle('collapsed');
                    });
                    advHeader.setAttribute('tabindex', '0');
                    advHeader.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            advHeader.click();
                        }
                    });
                }
            }
        });

        // After displaySavedFiles() in initialization, add:
        const lastFile = persistentStorage.getItem('leetcode_last_selected_file');
        if (lastFile && savedFiles.has(lastFile)) loadSavedFile(lastFile);

        // Add JS for modal, search, GitHub API fetch, and CSV loading:
        (function() {
            const githubBtn = document.getElementById('githubBrowseBtn');
            const modal = document.getElementById('githubModal');
            let companyFolders = [];
            let csvList = [];
            let filteredList = [];
            let currentView = 'companies'; // or 'csvs'
            let selectedCompany = null;
            let funMessageInterval;

            const ICONS = {
                folder: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" /></svg>`,
                file: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>`,
                backArrow: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" /></svg>`
            };

            function closeModal() {
                document.body.classList.remove('modal-open');
                document.documentElement.classList.remove('modal-open');
                modal.style.display = 'none';
                modal.innerHTML = '';
                currentView = 'companies';
                selectedCompany = null;
                if (funMessageInterval) clearInterval(funMessageInterval);
            }
            
            function buildModal(title, showSearch, showBack) {
                document.body.classList.add('modal-open');
                document.documentElement.classList.add('modal-open');
                modal.innerHTML = `
                    <div class="modal-overlay">
                        <div class="modal">
                            <div class="github-modal-header">
                                <button class="modal-close" title="Close">&times;</button>
                                <h2>${title}</h2>
                            </div>
                            <div id="github-modal-content-wrapper"></div>
                        </div>
                    </div>
                `;
                modal.classList.add('github-modal');
                modal.style.display = 'block';

                modal.querySelector('.modal-close').onclick = closeModal;
                modal.querySelector('.modal-overlay').onclick = e => { if (e.target === modal.querySelector('.modal-overlay')) closeModal(); };

                const contentWrapper = document.getElementById('github-modal-content-wrapper');
                let contentHtml = '';
                if (showBack) {
                    contentHtml += `
                        <div class="github-modal-search-wrapper" style="background:var(--bg-card) !important; border-bottom:none; padding-bottom:0;">
                            <button class="back-btn" style="background:var(--bg-card) !important;" id="backToCompanies">
                                ${ICONS.backArrow}
                                <span>Back to Companies</span>
                            </button>
                        </div>
                    `;
                }
                if (showSearch) {
                    contentHtml += `
                        <div class="github-modal-search-wrapper" style="position: sticky; top: 0; z-index: 10;">
                            <input class="github-modal-search" id="github-search-input" placeholder="Search..." />
                        </div>
                    `;
                }
                contentHtml += '<div class="modal-list"></div>';
                contentWrapper.innerHTML = contentHtml;

                if (showBack) {
                    document.getElementById('backToCompanies').onclick = () => fetchAndShowCompanies(false);
                }
            }

            function renderLoading(messages) {
                const contentWrapper = document.getElementById('github-modal-content-wrapper');
                if (!contentWrapper) return;

                let msgIdx = 0;
                contentWrapper.innerHTML = `
                    <div class="modal-loading">
                        <div class="spinner"></div>
                        <span id="fun-message">${messages[msgIdx]}</span>
                    </div>
                `;
                
                if (funMessageInterval) clearInterval(funMessageInterval);
                funMessageInterval = setInterval(() => {
                    msgIdx = (msgIdx + 1) % messages.length;
                    const msgEl = document.getElementById('fun-message');
                    if (msgEl) msgEl.textContent = messages[msgIdx];
                }, 1800);
            }

            function renderCompanyList(query) {
                const listContainer = modal.querySelector('.modal-list');
                if (!listContainer) return;

                listContainer.innerHTML = '';
                filteredList = companyFolders.filter(f => f.name.toLowerCase().includes(query.toLowerCase()));
                if (filteredList.length === 0) {
                    listContainer.innerHTML = '<div style="padding: 18px; color: #a1a1aa; text-align:center;">No companies found.</div>';
                    return;
                }
                filteredList.forEach(f => {
                    const item = document.createElement('div');
                    item.className = 'modal-list-item';
                    item.tabIndex = 0;
                    item.innerHTML = `
                        ${ICONS.folder}
                        <div>
                            <strong>${f.name.replace(/_/g, ' ')}</strong>
                        </div>
                    `;
                    item.onclick = () => {
                        selectedCompany = f.name.replace(/_/g, ' ');
                        fetchCSVsForCompany(f.url, selectedCompany);
                    };
                    item.onkeydown = e => { if (e.key === 'Enter' || e.key === ' ') item.onclick(); };
                    listContainer.appendChild(item);
                });
            }

            function renderCSVList(query) {
                const listContainer = modal.querySelector('.modal-list');
                if (!listContainer) return;

                listContainer.innerHTML = '';
                filteredList = csvList.filter(f => f.period.toLowerCase().includes(query.toLowerCase()));
                if (filteredList.length === 0) {
                    listContainer.innerHTML = '<div style="padding: 18px; color: #a1a1aa; text-align:center;">No lists found.</div>';
                    return;
                }
                filteredList.forEach(f => {
                    const item = document.createElement('div');
                    item.className = 'modal-list-item';
                    item.tabIndex = 0;
                    item.innerHTML = `
                        ${ICONS.file}
                        <div>
                            <strong>${f.period}</strong>
                            <div class="modal-list-item-desc">${f.description}</div>
                        </div>
                    `;
                    item.onclick = () => selectCSV(f);
                    item.onkeydown = e => { if (e.key === 'Enter' || e.key === ' ') selectCSV(f); };
                    listContainer.appendChild(item);
                });
            }

            let GITHUB_TOKEN = null;
            async function getGithubToken() {
                if (GITHUB_TOKEN) return GITHUB_TOKEN;
                try {
                    const res = await fetch('https://portfolio-api-dwyy.onrender.com/api/github-token');
                    const data = await res.json();
                    if (data.token) {
                        GITHUB_TOKEN = data.token;
                        return GITHUB_TOKEN;
                    } else { throw new Error('Token not found in response'); }
                } catch (e) {
                    throw new Error('Failed to fetch GitHub token: ' + (e.message || e));
                }
            }

            async function fetchCompanyFolders() {
                try {
                    const token = await getGithubToken();
                    const rootUrl = 'https://api.github.com/repos/liquidslr/leetcode-company-wise-problems/contents';
                    const rootRes = await fetch(rootUrl, { headers: { 'Authorization': `token ${token}` } });
                    if (!rootRes.ok) throw new Error('GitHub API error: ' + rootRes.status);
                    const rootFiles = await rootRes.json();
                    companyFolders = rootFiles.filter(f => f.type === 'dir');
                    return true;
                } catch (err) {
                    companyFolders = [];
                    return err.message || 'Unknown error';
                }
            }
            
            async function fetchAndShowCompanies(isFirstLoad) {
                if (isFirstLoad) {
                    buildModal('Browse Companies', false, false);
                    renderLoading([
                        "Grepping the GitHub firehose...",
                        "Polishing our DSA skills...",
                        "Brewing coffee for the code crawl...",
                        "Asking an AI for interview tips..."
                    ]);
                    const result = await fetchCompanyFolders();
                    if (funMessageInterval) clearInterval(funMessageInterval);
                    if (result !== true) {
                        modal.querySelector('.modal-loading').innerHTML = `<h2>Error</h2><p>${result}</p>`;
                        return;
                    }
                }
                
                buildModal('Browse Companies', true, false);
                modal.querySelector('#github-search-input').oninput = e => renderCompanyList(e.target.value);
                modal.querySelector('#github-search-input').placeholder = 'Search companies...';
                renderCompanyList('');
            }

            async function fetchCSVsForCompany(folderUrl, company) {
                buildModal(`Lists for ${company}`, true, true);
                renderLoading([
                    "Sorting CSVs by date...",
                    "Finding the latest question list...",
                    "Preparing your practice session..."
                ]);

                try {
                    const token = await getGithubToken();
                    const folderRes = await fetch(folderUrl, { headers: { 'Authorization': `token ${token}` } });
                    if (!folderRes.ok) throw new Error('GitHub API error: ' + folderRes.status);
                    const folderFiles = await folderRes.json();
                    if (funMessageInterval) clearInterval(funMessageInterval);

                    csvList = folderFiles.filter(f => f.name.endsWith('.csv')).map(f => {
                        const periodDescription = getPeriodDescription(f.name);
                        return {
                            name: f.name,
                            download_url: f.download_url,
                            company: company,
                            period: periodDescription.label,
                            description: periodDescription.description
                        };
                    });
                    
                    buildModal(`Lists for ${company}`, true, true);
                    modal.querySelector('#github-search-input').oninput = e => renderCSVList(e.target.value);
                    modal.querySelector('#github-search-input').placeholder = 'Search by period (e.g., 6 months)...';
                    renderCSVList('');
                } catch (err) {
                    if (funMessageInterval) clearInterval(funMessageInterval);
                    modal.querySelector('.modal-list').innerHTML = `<div style="padding:18px; color:var(--accent4);">${err.message || 'Unknown error'}</div>`;
                }
            }

            function getPeriodDescription(period) {
                const periodLower = period.toLowerCase().trim();
                
                // Convert common period names to descriptive labels based on actual API response
                if (periodLower.includes('thirty days') || periodLower.includes('30 days') || periodLower.includes('30day')) {
                    return {
                        label: 'Last 30 Days',
                        description: 'Questions asked in the past 30 days'
                    };
                } else if (periodLower.includes('three months') || periodLower.includes('3 months') || periodLower.includes('3month')) {
                    return {
                        label: 'Last 3 Months',
                        description: 'Questions asked in the past 3 months'
                    };
                } else if (periodLower.includes('more than six months') || periodLower.includes('6 months') || periodLower.includes('6month')) {
                    return {
                        label: 'More Than 6 Months',
                        description: 'Questions asked in more than past 6 months ago'
                    };
                } else if (periodLower.includes('six months') || periodLower.includes('more than 6 months')) {
                    return {
                        label: 'Last 6 Months',
                        description: 'Questions asked in the past 6 months'
                    };
                } else if (periodLower.includes('all') && !periodLower.includes('more than')) {
                    return {
                        label: 'All Time',
                        description: 'All questions ever asked by this company'
                    };
                } else if (periodLower.includes('one year') || periodLower.includes('1 year') || periodLower.includes('year') || periodLower.includes('12months')) {
                    return {
                        label: 'Last 1 Year',
                        description: 'Questions asked in the past year'
                    };
                } else if (periodLower.includes('two months') || periodLower.includes('2 months') || periodLower.includes('2month')) {
                    return {
                        label: 'Last 2 Months',
                        description: 'Questions asked in the past 2 months'
                    };
                } else if (periodLower.includes('four months') || periodLower.includes('4 months') || periodLower.includes('4month')) {
                    return {
                        label: 'Last 4 Months',
                        description: 'Questions asked in the past 4 months'
                    };
                } else if (periodLower.includes('nine months') || periodLower.includes('9 months') || periodLower.includes('9month')) {
                    return {
                        label: 'Last 9 Months',
                        description: 'Questions asked in the past 9 months'
                    };
                } else {
                    // For any other period, format it nicely and try to extract time information
                    // Remove numbered prefixes like "1. ", "2. " etc.
                    const cleanPeriod = period.replace(/^\d+\.\s*/, '').replace('.csv', '');
                    const formattedPeriod = cleanPeriod.replace(/(\d+)([a-zA-Z]+)/g, '$1 $2').replace(/\b\w/g, l => l.toUpperCase());
                    return {
                        label: formattedPeriod,
                        description: 'Questions from this time period'
                    };
                }
            }

            githubBtn.onclick = () => fetchAndShowCompanies(true);
            
            async function selectCSV(file) {
                // Don't close the modal, just change its content to the download progress UI.
                // This keeps the backdrop and scroll-lock active.
                const headerTitle = modal.querySelector('.github-modal-header h2');
                if(headerTitle) headerTitle.textContent = 'Downloading...';

                const contentWrapper = modal.querySelector('#github-modal-content-wrapper');
                if (contentWrapper) {
                    contentWrapper.innerHTML = `
                        <div class="modal-loading" style="justify-content:flex-start; padding-top:24px;">
                            <h2 style="font-size:1.1em; margin-top:0;">${file.period} list for ${file.company}</h2>
                            <div class="progress-bar" style="height: 24px; width: 100%; max-width: 300px;">
                                <div class="progress-fill" id="downloadProgressFill" style="width: 0%; transition: width 0.1s linear;"></div>
                            </div>
                            <div id="downloadProgressText" style="margin-top: 12px; color: var(--text-muted);">0%</div>
                        </div>
                    `;
                } else {
                    // Fallback for safety, though it shouldn't be needed with the new structure.
                    closeModal();
                    document.body.classList.add('modal-open');
                    modal.innerHTML = `
                        <div class="modal-overlay"><div class="modal" style="text-align:center;">
                            <h2>Downloading...</h2>
                            <div class="progress-bar" style="height:24px;"><div id="downloadProgressFill" class="progress-fill" style="width:0%;"></div></div>
                            <div id="downloadProgressText" style="margin-top:12px;">0%</div>
                        </div></div>
                    `;
                    modal.style.display = 'block';
                }

                try {
                    const res = await fetch(file.download_url);
                    if (!res.ok) throw new Error(`Network response was not ok: ${res.statusText}`);
                    
                    const contentLength = res.headers.get('content-length');
                    const totalSize = contentLength ? parseInt(contentLength, 10) : 0;
                    let loadedSize = 0;
                    
                    const reader = res.body.getReader();
                    const chunks = [];
                    const progressFill = document.getElementById('downloadProgressFill');
                    const progressText = document.getElementById('downloadProgressText');

                    while(true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        
                        chunks.push(value);
                        loadedSize += value.length;
                        
                        if (totalSize > 0) {
                            const percent = Math.min(100, Math.round((loadedSize / totalSize) * 100));
                            if (progressFill) progressFill.style.width = `${percent}%`;
                            if (progressText) progressText.textContent = `${percent}%`;
                        }
                    }

                    if (progressFill) progressFill.style.width = '100%';
                    if (progressText) progressText.textContent = 'Parsing data...';

                    // Combine chunks and decode
                    const allChunks = new Uint8Array(loadedSize);
                    let position = 0;
                    chunks.forEach(chunk => {
                        allChunks.set(chunk, position);
                        position += chunk.length;
                    });
                    const csvText = new TextDecoder('utf-8').decode(allChunks);
                    
                    // Give a moment for the user to see the "Parsing" message
                    setTimeout(() => {
                        Papa.parse(csvText, {
                            header: true,
                            skipEmptyLines: true,
                            dynamicTyping: true,
                            complete: function(results) {
                                closeModal(); // Close modal on success
                                // Map to internal format
                                currentFileData = results.data.map(mapCSVRow);
                                questionsData = currentFileData;
                                // Remove any leading numbers/dots/spaces from company and period
                                const cleanCompany = file.company.replace(/^\d+\.\s*/, '');
                                const cleanPeriod = file.period.replace(/^\d+\.\s*/, '');
                                currentFileName = cleanCompany + ' ' + cleanPeriod;
                                updateCurrentFileDisplay();
                                loadCompletedQuestions();
                                updateDisplay();
                                showSections();
                                // Suggest saving
                                setTimeout(() => {
                                    savedFiles.set(cleanCompany + ' ' + cleanPeriod, {
                                        data: currentFileData,
                                        progress: [...completedQuestions],
                                        uploadDate: new Date().toISOString(),
                                        lastUpdated: new Date().toISOString(),
                                        originalName: file.name
                                    });
                                    currentFileName = cleanCompany + ' ' + cleanPeriod;
                                    saveSavedFiles();
                                    displaySavedFiles();
                                    window.alert('File saved successfully!');
                                }, 300);
                            },
                            error: function(error) {
                                modal.innerHTML = `<div class=\"modal-overlay\"><div class=\"modal\"><button class=\"modal-close\" title=\"Close\">&times;</button><h2>Error parsing CSV</h2><div style=\"color:#ef4444; margin:18px 0;\">${error.message}</div></div></div>`;
                                modal.querySelector('.modal-close').onclick = () => { modal.style.display = 'none'; modal.innerHTML = ''; };
                            }
                        });
                    }, 200);

                } catch (e) {
                    modal.innerHTML = `<div class=\"modal-overlay\"><div class=\"modal\"><button class=\"modal-close\" title=\"Close\">&times;</button><h2>Error downloading CSV</h2><div style=\"color:#ef4444; margin:18px 0;\">${e.message || 'Unknown error'}</div></div></div>`;
                    modal.querySelector('.modal-close').onclick = () => { modal.style.display = 'none'; modal.innerHTML = ''; };
                }
            }
        })();

        // Paging handler
        window.changeQuestionsPage = function(page) {
            currentQuestionsPage = page;
            if (currentFileName) {
                persistentStorage.setItem(getPageKey(currentFileName), String(page));
            }
            renderQuestions();
        }

        // THEME TOGGLE LOGIC (refined)
        const themeMap = {
            dark: {
                class: '',
                icon: 'icon-moon',
                name: 'Dark'
            },
            light: {
                class: 'theme-light',
                icon: 'icon-sun',
                name: 'Light'
            },
            solarized: {
                class: 'theme-solarized',
                icon: 'icon-solar',
                name: 'Solarized'
            },
            forest: {
                class: 'theme-forest',
                icon: 'icon-forest',
                name: 'Forest'
            },
            ocean: {
                class: 'theme-ocean',
                icon: 'icon-ocean',
                name: 'Ocean'
            },
            cyberpunk: {
                class: 'theme-cyberpunk',
                icon: 'icon-cyberpunk',
                name: 'Cyberpunk'
            }
        };
        function setTheme(theme) {
            Object.values(themeMap).forEach(t => t.class && document.body.classList.remove(t.class));
            if (themeMap[theme].class) document.body.classList.add(themeMap[theme].class);
            // Show only the correct SVG icon
            Object.values(themeMap).forEach(t => document.getElementById(t.icon).style.display = 'none');
            document.getElementById(themeMap[theme].icon).style.display = 'block';
            localStorage.setItem('leetcode_theme', theme);
            // Re-render charts to update theme colors
            if (typeof updateChart === 'function') setTimeout(updateChart, 0);
        }
        function getSavedTheme() {
            return localStorage.getItem('leetcode_theme') || 'dark';
        }
        document.addEventListener('DOMContentLoaded', function() {
            // Apply saved theme
            setTheme(getSavedTheme());
            // Toggle dropdown
            const btn = document.getElementById('themeToggleBtn');
            const dropdown = document.getElementById('themeDropdown');
            btn.onclick = function(e) {
                e.stopPropagation();
                const expanded = dropdown.classList.toggle('show');
                btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
                if (expanded) dropdown.querySelector('.theme-dropdown-item.active')?.focus();
            };
            // Dropdown item click (only for theme items)
            dropdown.querySelectorAll('.theme-dropdown-item[data-theme]').forEach(item => {
                item.onclick = function(e) {
                    const theme = item.getAttribute('data-theme');
                    if (theme) setTheme(theme);
                    dropdown.classList.remove('show');
                    btn.setAttribute('aria-expanded', 'false');
                    btn.focus();
                };
                item.onkeydown = function(e) {
                    if (e.key === 'Enter' || e.key === ' ') { item.click(); }
                    if (e.key === 'ArrowDown') { e.preventDefault(); item.nextElementSibling?.focus(); }
                    if (e.key === 'ArrowUp') { e.preventDefault(); item.previousElementSibling?.focus(); }
                    if (e.key === 'Escape') { dropdown.classList.remove('show'); btn.setAttribute('aria-expanded', 'false'); btn.focus(); }
                };
            });
            // Keyboard: open with Enter/Space
            btn.onkeydown = function(e) {
                if (e.key === 'Enter' || e.key === ' ') { btn.click(); }
                if (e.key === 'ArrowDown') { dropdown.classList.add('show'); dropdown.querySelector('.theme-dropdown-item.active')?.focus(); }
            };
            // Close dropdown on outside click
            document.addEventListener('mousedown', function(e) {
                if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
                    dropdown.classList.remove('show');
                    btn.setAttribute('aria-expanded', 'false');
                }
            });
            // Highlight active
            function updateActive() {
                const current = getSavedTheme();
                dropdown.querySelectorAll('.theme-dropdown-item').forEach(item => {
                    if (item.getAttribute('data-theme') === current) item.classList.add('active');
                    else item.classList.remove('active');
                });
            }
            updateActive();
            // Update active on theme change
            btn.addEventListener('click', updateActive);
            dropdown.querySelectorAll('.theme-dropdown-item').forEach(item => {
                item.addEventListener('click', updateActive);
            });
            // Aurora toggle event (separate)
            const auroraBtn = document.getElementById('auroraToggleBtn');
            if (auroraBtn) {
                auroraBtn.onclick = function(e) {
                    e.stopPropagation();
                    const enabled = !getAuroraEnabled();
                    setAuroraEnabled(enabled);
                };
                auroraBtn.onkeydown = function(e) {
                    if (e.key === 'Enter' || e.key === ' ') { auroraBtn.click(); }
                };
            }
            // Set initial state
            setAuroraEnabled(getAuroraEnabled());
        });

        // Custom Modal Dialog Logic
        function showCustomModal(type, message, onConfirm, onCancel) {
          document.body.classList.add('modal-open');
          document.documentElement.classList.add('modal-open');
          const overlay = document.getElementById('customModalOverlay');
          const modal = document.getElementById('customModal');
          const msg = document.getElementById('customModalMessage');
          const btns = document.getElementById('customModalButtons');
          msg.textContent = message;
          btns.innerHTML = '';
          overlay.style.display = 'flex';
          function close() {
            overlay.style.display = 'none';
            document.body.classList.remove('modal-open');
            document.documentElement.classList.remove('modal-open');
          }
          if (type === 'alert') {
            const ok = document.createElement('button');
            ok.textContent = 'OK';
            ok.className = 'reset-btn';
            ok.onclick = () => { close(); if (onConfirm) onConfirm(); };
            btns.appendChild(ok);
          } else if (type === 'confirm') {
            const yes = document.createElement('button');
            yes.textContent = 'Yes';
            yes.className = 'reset-btn';
            yes.onclick = () => { close(); if (onConfirm) onConfirm(); };
            const no = document.createElement('button');
            no.textContent = 'No';
            no.className = 'reset-btn';
            no.onclick = () => { close(); if (onCancel) onCancel(); };
            btns.appendChild(yes);
            btns.appendChild(no);
          } else if (type === 'prompt') {
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'modal-search';
            input.style.marginBottom = '18px';
            btns.appendChild(input);
            const ok = document.createElement('button');
            ok.textContent = 'OK';
            ok.className = 'reset-btn';
            ok.onclick = () => { close(); if (onConfirm) onConfirm(input.value); };
            btns.appendChild(ok);
            const cancel = document.createElement('button');
            cancel.textContent = 'Cancel';
            cancel.className = 'reset-btn';
            cancel.onclick = () => { close(); if (onCancel) onCancel(); };
            btns.appendChild(cancel);
          }
          overlay.onclick = e => { if (e.target === overlay) close(); };
        }
        // Replace alert, confirm, prompt in code below
        window.alert = (msg) => showCustomModal('alert', msg);
        window.confirm = (msg) => new Promise(res => showCustomModal('confirm', msg, () => res(true), () => res(false)));
        window.prompt = (msg, def) => new Promise(res => showCustomModal('prompt', msg, v => res(v), () => res(null)));

        // --- CounterAPI V2 integration for global stats ---
        // const counter = new Counter({ workspace: 'leetcode-tracker' });

        // async function updateGlobalStats() {
        //     const visitsEl = document.getElementById('totalVisits');
        //     const solvedEl = document.getElementById('totalSolved');

        //     // Increment and get visit count
        //     counter.up('visit').then(result => {
        //         if (visitsEl) visitsEl.textContent = (result.value || 0).toLocaleString();
        //     }).catch(error => {
        //         console.error('CounterAPI visit error:', error);
        //         if (visitsEl) visitsEl.textContent = 'N/A';
        //     });

        //     // Get total solved count
        //     counter.get('total-solved').then(result => {
        //         if (solvedEl) solvedEl.textContent = (result.value || 0).toLocaleString();
        //     }).catch(error => {
        //         console.error('CounterAPI get solved error:', error);
        //         if (solvedEl) solvedEl.textContent = 'N/A';
        //     });
        // }

        // async function incrementSolvedCounter() {
        //     const solvedEl = document.getElementById('totalSolved');
        //     counter.up('total-solved').then(result => {
        //         if (solvedEl) solvedEl.textContent = (result.value || 0).toLocaleString();
        //     }).catch(error => {
        //         console.error('CounterAPI increment solved error:', error);
        //     });
        // }

        // function toggleQuestion(id) {
        //     if (id == null) return;
        //     const idStr = id.toString();
        //     if (completedQuestions.has(idStr)) {
        //         completedQuestions.delete(idStr);
        //     } else {
        //         completedQuestions.add(idStr);
        //         incrementSolvedCounter();
        //     }
        //     saveCompletedQuestions();
        //     updateDisplay();
        // }

        // Initialize
        loadSavedFiles();
        displaySavedFiles();
        // updateGlobalStats();

        // Aurora Toggle Logic
        function setAuroraEnabled(enabled) {
          // Check if device is mobile
          const isMobile = window.innerWidth <= 768;
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          
          // Disable aurora on mobile or if user prefers reduced motion
          if (isMobile || prefersReducedMotion) {
            enabled = false;
            if (isMobile) {
              // Show a subtle message that aurora is disabled on mobile
              console.log('Aurora background is disabled on mobile devices for better performance');
            }
          }
          
          if (enabled) document.body.classList.add('aurora-enabled');
          else document.body.classList.remove('aurora-enabled');
          localStorage.setItem('leetcode_aurora_enabled', enabled ? '1' : '0');
          updateAuroraSwitchUI(enabled);
        }
        function getAuroraEnabled() {
          // Check if device is mobile
          const isMobile = window.innerWidth <= 768;
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          
          // Force disable on mobile or reduced motion preference
          if (isMobile || prefersReducedMotion) {
            return false;
          }
          
          return localStorage.getItem('leetcode_aurora_enabled') === '1';
        }
        function updateAuroraSwitchUI(enabled) {
          const switchEl = document.getElementById('auroraToggleSwitch');
          const mobileIndicator = document.getElementById('auroraMobileIndicator');
          if (!switchEl) return;
          
          // Check if device is mobile
          const isMobile = window.innerWidth <= 768;
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          
          // Show mobile indicator if on mobile
          if (mobileIndicator) {
            if (isMobile) {
              mobileIndicator.style.display = 'inline';
              mobileIndicator.textContent = '(Mobile disabled)';
            } else if (prefersReducedMotion) {
              mobileIndicator.style.display = 'inline';
              mobileIndicator.textContent = '(Motion reduced)';
            } else {
              mobileIndicator.style.display = 'none';
            }
          }
          
          if (enabled && !isMobile && !prefersReducedMotion) {
            switchEl.style.background = 'var(--accent)';
            switchEl.firstElementChild.style.left = '18px';
            switchEl.firstElementChild.style.background = '#fff';
          } else {
            switchEl.style.background = 'var(--bg-accent)';
            switchEl.firstElementChild.style.left = '2px';
            switchEl.firstElementChild.style.background = 'var(--accent)';
          }
        }

        // --- Aurora Dynamic Color Animation (JS) - Optimized for Performance ---
        (function() {
          if (!window.requestAnimationFrame) return;
          
          // Check if device is mobile or has reduced motion preference
          const isMobile = window.innerWidth <= 768;
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          
          // Skip animation on mobile or if user prefers reduced motion
          if (isMobile || prefersReducedMotion) return;
          
          const root = document.documentElement;
          let t = 0;
          let animationId = null;
          
          function hslToHex(h, s, l) {
            l /= 100; s /= 100;
            let c = (1 - Math.abs(2 * l - 1)) * s, x = c * (1 - Math.abs((h / 60) % 2 - 1)), m = l - c/2, r=0, g=0, b=0;
            if (0 <= h && h < 60) { r = c; g = x; b = 0; }
            else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
            else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
            else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
            else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
            else if (300 <= h && h < 360) { r = c; g = 0; b = x; }
            r = Math.round((r + m) * 255);
            g = Math.round((g + m) * 255);
            b = Math.round((b + m) * 255);
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
          }
          
          function animateAurora() {
            t += 0.005; // Reduced speed for better performance
            // Animate the CSS variables for aurora colors (only 3 colors now)
            const h1 = (200 + 40 * Math.sin(t)) % 360;
            const h2 = (260 + 60 * Math.cos(t * 0.7)) % 360;
            const h3 = (50 + 30 * Math.sin(t * 1.3)) % 360;
            
            root.style.setProperty('--aurora1', hslToHex(h1, 100, 70));
            root.style.setProperty('--aurora2', hslToHex(h2, 90, 60));
            root.style.setProperty('--aurora3', hslToHex(h3, 95, 65));
            
            animationId = requestAnimationFrame(animateAurora);
          }
          
          function startAuroraAnimation() {
            if (isMobile || prefersReducedMotion) return;
            if (!animationId && document.body.classList.contains('aurora-enabled')) {
              animateAurora();
            }
          }
          
          function stopAuroraAnimation() {
            if (animationId) {
              cancelAnimationFrame(animationId);
              animationId = null;
            }
          }
          
          // Start animation if aurora is enabled on load
          if (document.body.classList.contains('aurora-enabled')) {
            startAuroraAnimation();
          }
          
          // Observer for aurora toggle changes
          const observer = new MutationObserver(() => {
            if (document.body.classList.contains('aurora-enabled')) {
              startAuroraAnimation();
            } else {
              stopAuroraAnimation();
            }
          });
          observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
          
          // Clean up on page unload
          window.addEventListener('beforeunload', stopAuroraAnimation);
        })();

        document.getElementById('zenModeBtn').addEventListener('click', function(e) {
          e.stopPropagation();
          const isZen = document.body.classList.toggle('zen-mode');
          this.innerText = isZen ? '🗗' : '🗖';
          this.title = isZen ? 'Exit Full Screen' : 'Full Screen';
          if (isZen) {
            document.getElementById('questionsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
          // Do not scroll on exit
        });

        function updateCurrentFileDisplay() {
          const el = document.getElementById('currentFileDisplay');
          if (!el) return;
          if (currentFileName && currentFileName.trim() && window.innerWidth > 600) {
            const firstWord = currentFileName.trim().split(/\s+/)[0];
            el.textContent = firstWord;
            el.title = currentFileName;
            el.style.display = '';
          } else {
            el.textContent = '';
            el.title = '';
            el.style.display = 'none';
          }
        }
        window.addEventListener('resize', updateCurrentFileDisplay);
    </script>
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h4>About LeetCode Company Questions</h4>
                <p>This comprehensive tool helps software engineers and computer science students prepare for technical interviews by providing company-specific LeetCode questions. Access coding challenges and solutions tailored for interviews at top tech companies like Google, Amazon, Facebook, Apple, Netflix, Microsoft, and more.</p>
            </div>
            <div class="footer-column">
                <h4>Features & Benefits</h4>
                <ul class="footer-links">
                    <li>📊 Progress tracking and visualization</li>
                    <li>🏢 Company-specific question lists</li>
                    <li>📈 Completion rate analytics</li>
                    <li>💾 Save and manage practice sessions</li>
                    <li>🎯 Filter by difficulty and status</li>
                    <li>📱 Mobile-friendly interface</li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Credits & Data Sources</h4>
                <ul class="footer-links">
                    <li>Problem data sourced from <a href="https://github.com/liquidslr/leetcode-company-wise-problems" target="_blank" rel="noopener noreferrer">liquidslr's Repository</a></li>
                    <li>UI & functionality developed by <a href="https://ronakraj00.github.io/portfolio/" target="_blank" rel="noopener noreferrer">Ronak Raj</a></li>
                    <li>Free tool for interview preparation</li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Developer & Contact</h4>
                <p>Ronak Raj - Software Engineer</p>
                <p style="font-size:0.9em; color:var(--text-muted);">Creating tools to help developers succeed in technical interviews</p>
                <div class="footer-socials">
                    <a href="https://github.com/Ronakraj00" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
                        <svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.168 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.378.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.943.359.308.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.003 10.003 0 0022 12c0-5.523-4.477-10-10-10z" clip-rule="evenodd"></path></svg>
                    </a>
                    <a href="https://www.linkedin.com/in/ronakraj00/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                        <svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <span id="footer-emoji" aria-label="brain">🧠</span> Made with code and coffee by Ronak Raj. Free tool for LeetCode interview preparation.
        </div>
    </footer>
    <style>
      @media (max-width: 600px) {
        .site-footer { padding: 32px 24px; }
        .footer-container { text-align: center; }
        .footer-socials { justify-content: center; }
      }
      .container { padding-bottom: 0 !important; }
    </style>
    <script>
      // Emoji alternator for footer
      (function() {
        const emojiSpan = document.getElementById('footer-emoji');
        if (!emojiSpan) return;
        const emojis = [
          { char: '❤️', label: 'love' },
          { char: '🧠', label: 'brain' },
          { char: '☕', label: 'coffee' },
          { char: '🔥', label: 'fire' },
          { char: '💻', label: 'laptop' }
        ];
        let idx = 0;
        setInterval(() => {
          idx = (idx + 1) % emojis.length;
          emojiSpan.textContent = emojis[idx].char;
          emojiSpan.setAttribute('aria-label', emojis[idx].label);
        }, 1200);
      })();
    </script>
    <style id="zen-mode-style">
        .zen-mode .header,
        .zen-mode .upload-section,
        .zen-mode #statsSection,
        .zen-mode #chartSection,
        .zen-mode #controlsSection,
        .zen-mode .site-footer {
          display: none !important;
        }
        .zen-mode #questionsSection {
          margin-top: 32px !important;
          border-radius: 18px !important;
          box-shadow: 0 4px 32px 0 #00000022 !important;
          border: 1px solid var(--accent);
        }
        .zen-mode body, body.zen-mode {
          background: var(--bg-main) !important;
        }
    </style>
</body>
</html>